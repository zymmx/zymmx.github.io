<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title>木木夕</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="/lib/jquery.js"></script>
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
  <script src="/js/common.js"></script>
  <script src="/lib/bootstrap/js/bootstrap.js"></script>
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
</head>

  <body>
    <header class="header">
  <div class="color-bar">
    <ul>
      <li class="bar1"></li>
      <li class="bar2"></li>
      <li class="bar3"></li>
      <li class="bar4"></li>
      <li class="bar5"></li>
      <li class="bar6"></li>
    </ul>
  </div>
  <div class="header-wrapper">
    <div class="blog-title">
      
      <a href="/" class="title">木木夕</a>
    </div>
    <nav class="navbar navbar-menu">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" id="nav-btn" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
      </div>
        <ul class="menu menu-pc">
          
            <li class="menu-item">
              <a href="/" class="menu-item-link"><i class="fa fa-home"></i><span>首页</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/tags/" class="menu-item-link"><i class="fa fa-tags"></i><span>标签</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/archives/" class="menu-item-link"><i class="fa fa-file"></i><span>归档</span></a>
            </li>
          
            <li class="menu-item">
              <a href="https://github.com/zymmx/" class="menu-item-link"><i class="fa fa-github"></i><span>github</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/about/" class="menu-item-link"><i class="fa fa-user"></i><span>关于</span></a>
            </li>
          
        </ul>
    </nav>
  </div>
</header>
<div class="collapse nav-collapse" style="position:fixed;top:59px;" id="bs-example-navbar-collapse-1">
  <ul class="menu menu-mobile" style="list-style:none">
    
      <li class="menu-item">
        <a href="/" class="menu-item-link"><i class="fa fa-home"></i><span>首页</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/tags/" class="menu-item-link"><i class="fa fa-tags"></i><span>标签</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/archives/" class="menu-item-link"><i class="fa fa-file"></i><span>归档</span></a>
      </li>
    
      <li class="menu-item">
        <a href="https://github.com/zymmx/" class="menu-item-link"><i class="fa fa-github"></i><span>github</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/about/" class="menu-item-link"><i class="fa fa-user"></i><span>关于</span></a>
      </li>
    
  </ul>
</div>

    <main class="main">
      <div class="content">
        
  <article class="post">
    <div class="post-title">
      <h2 class="title">Spring详解</h2>
       
        <p>Spring</p>
      
    </div>
     <div class="post-meta">
      <span class="post-time">2018-12-04</span>
    </div>
    <div class="post-content">
      <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h3 id="一、什么是spring"><a href="#一、什么是spring" class="headerlink" title="一、什么是spring"></a><strong>一、什么是spring</strong></h3><p>Spring框架，由Rod Johnson开发</p>
<p>Spring是一个非常活跃的开源框架, 基于IOC和AOP来构架多层JavaEE系统，以帮助分离项目组件之间的依赖关系</p>
<h3 id="二、核心概念"><a href="#二、核心概念" class="headerlink" title="二、核心概念"></a><strong>二、核心概念</strong></h3><p>IoC：Inversion of Control 控制反转</p>
<p>DI：Dependency Injection,依赖注入</p>
<p>AOP：Aspect Oriented Programming 面向切面编程</p>
<h3 id="三、Spring的组成"><a href="#三、Spring的组成" class="headerlink" title="三、Spring的组成"></a>三、Spring的组成</h3><p>Spring框架包含的功能大约由20个模块组成。这些模块按组可分为核心容器、数据访问/集成，Web，AOP(面向切面编程)、设备、消息和测试</p>
<p>核心模块：Beans、Core、Context、SpEL对应四个初始化项目时需要的四个核心包</p>
<h3 id="四、模块介绍"><a href="#四、模块介绍" class="headerlink" title="四、模块介绍"></a><strong>四、模块介绍</strong></h3><p><img src="file:///C:/Users/Administrator/AppData/Local/YNote/data/qq132A2E2A6F99F50B04B76F27A6BF258B/c5f70e31413a43fcae3e3bf491ebb481/1543914178279.png" alt="img"> </p>
<p><img src="file:///C:/Users/Administrator/AppData/Local/YNote/data/qq132A2E2A6F99F50B04B76F27A6BF258B/7386423a645241c49b58b67fa3dee1c0/1543914195341.png" alt="img"> </p>
<h3 id="五、模块详解"><a href="#五、模块详解" class="headerlink" title="五、模块详解"></a><strong>五、模块详解</strong></h3><p><strong>1、core - 核心模块</strong></p>
<ul>
<li>spring-core：依赖注入IoC与DI的最基本实现</li>
<li>spring-beans：Bean工厂与bean的装配</li>
<li>spring-context：spring的context上下文即IoC容器</li>
<li>spring-context-support</li>
<li>spring-expression：spring表达式语言</li>
</ul>
<p><strong>核心模块说明</strong></p>
<p>（1）spring-core</p>
<p>这个jar文件包含Spring框架基本的核心工具类，Spring其它组件要都要使用到这个包里的类，是其它组件的基本核心，当然你也可以在自己的应用系统中使用这些工具类</p>
<p>（2）spring-beans</p>
<p>这个jar文件是所有应用都要用到的，它包含访问配置文件、创建和管理bean以及进行Inversion of Control / Dependency Injection（IoC/DI）操作相关的所有类。如果应用只需基本的IoC/DI支持，引入spring-core.jar及spring- beans.jar文件就可以了</p>
<p>（3）spring-context</p>
<p>Spring核心提供了大量扩展，这样使得由 Core 和 Beans 提供的基础功能增强：这意味着Spring 工程能以框架模式访问对象。Context 模块继承了Beans 模块的特性并增加了对国际化（例如资源绑定）、事件传播、资源加载和context 透明化（例如 Servlet container）。同时，也支持JAVA EE 特性，例如 EJB、 JMX 和 基本的远程访问。Context 模块的关键是 ApplicationContext 接口。spring-context-support 则提供了对第三方库集成到 Spring-context 的支持，比如缓存（EhCache, Guava, JCache）、邮件（JavaMail）、调度（CommonJ, Quartz）、模板引擎（FreeMarker, JasperReports, Velocity）等。</p>
<p>（4）spring-expression</p>
<p>为在运行时查询和操作对象图提供了强大的表达式语言。它是JSP2.1规范中定义的统一表达式语言的扩展，支持 set 和 get 属性值、属性赋值、方法调用、访问数组集合及索引的内容、逻辑算术运算、命名变量、通过名字从Spring IoC容器检索对象，还支持列表的投影、选择以及聚合等。</p>
<p><strong>2、Data Access/Integration - 数据访问与集成</strong></p>
<p>数据访问与集成层包含 JDBC、ORM、OXM、JMS和事务模块。</p>
<p><strong>详细说明</strong></p>
<p>（1）spring-jdbc</p>
<p>提供了 JDBC抽象层，它消除了冗长的 JDBC 编码和对数据库供应商特定错误代码的解析。</p>
<p>（2）spring-tx</p>
<p>支持编程式事务和声明式事务，可用于实现了特定接口的类和所有的 POJO 对象。编程式事务需要自己写beginTransaction()、commit()、rollback()等事务管理方法，声明式事务是通过注解或配置由 spring 自动处理，编程式事务粒度更细。</p>
<p>（3）spring-orm</p>
<p>提供了对流行的对象关系映射 API的集成，包括 JPA、JDO 和 Hibernate 等。通过此模块可以让这些 ORM 框架和 spring 的其它功能整合，比如前面提及的事务管理。</p>
<p>（4）spring-oxm </p>
<p>模块提供了对 OXM 实现的支持，比如JAXB、Castor、XML Beans、JiBX、XStream等。</p>
<p>（5）spring-jms</p>
<p>模块包含生产（produce）和消费（consume）消息的功能。从Spring 4.1开始，集成了 spring-messaging 模块</p>
<p><strong>3、Web</strong></p>
<p>Web 层包括 spring-web、spring-webmvc、spring-websocket、spring-webmvc-portlet 等模块。</p>
<p><strong>详细说明</strong></p>
<p>（1）spring-web</p>
<p>提供面向 web 的基本功能和面向 web 的应用上下文，比如 multipart 文件上传功能、使用 Servlet 监听器初始化 IoC 容器等。它还包括 HTTP 客户端以及 Spring 远程调用中与 web 相关的部分</p>
<p>（2）spring-webmvc</p>
<p>为 web 应用提供了模型视图控制（MVC）和 REST Web 服务的实现。Spring 的 MVC 框架可以使领域模型代码和 web 表单完全地分离，且可以与 Spring 框架的其它所有功能进行集成</p>
<p>（3）spring-webmvc-portlet</p>
<p>（即Web-Portlet模块）提供了用于 Portlet 环境的 MVC 实现，并反映了 pring-webmvc 模块的功能</p>
<p><strong>4、AOP</strong></p>
<p>（1）spring-aop</p>
<p>提供了面向切面编程（AOP）的实现，可以定义诸如方法拦截器和切入点等，从而使实现功能的代码彻底的解耦。使用源码级的元数据。</p>
<p>（2）spring-aspects</p>
<p>提供了对 AspectJ 的集成</p>
<p><strong>5、Instrumentation</strong></p>
<p>（1）spring-instrument</p>
<p>模块提供了对检测类的支持和用于特定的应用服务器的类加载器的实现。</p>
<p>（2）spring-instrument-tomcat</p>
<p>模块包含了用于 Tomcat 的Spring 检测代理。</p>
<p><strong>6、Messaging - 消息处理</strong></p>
<p>spring-messaging 模块</p>
<p>从 Spring 4 开始集成，从一些 Spring 集成项目的关键抽象中提取出来的。这些项目包括 Message、MessageChannel、MessageHandler 和其它服务于消息处理的项目。这个模块也包含一系列的注解用于映射消息到方法</p>
<p><strong>7、Test</strong></p>
<p>spring-test 模块</p>
<p>通过 JUnit 和 TestNG 组件支持单元测试和集成测试。它提供了一致性地加载和缓存 Spring 上下文，也提供了用于单独测试代码的模拟对象（mock object）</p>
<h3 id="六、入门程序和IOC"><a href="#六、入门程序和IOC" class="headerlink" title="六、入门程序和IOC"></a>六、入门程序和IOC</h3><p><strong>1、下载</strong></p>
<p>Spring框架的主页：<a href="http://spring.io/" target="_blank" rel="noopener">http://spring.io/</a></p>
<p>下载地址：<a href="http://repo.spring.io/release/org/springframework/spring" target="_blank" rel="noopener">http://repo.spring.io/release/org/springframework/spring</a></p>
<p><strong>2、创建项目</strong></p>
<p>spring-01-IOC</p>
<p>java项目或maven项目</p>
<p><strong>3、引入jar包</strong></p>
<p>核心包加日志包</p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543914559520.png" alt="1543914559520"></p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543914568281.png" alt="1543914568281"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pom:</span><br><span class="line">&lt;!-- spring --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!-- 日志处理 --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p> <strong>4、引入log4j.properties</strong></p>
<p>放入源码目录（maven项目放在src/mian/resources下）</p>
<p> <strong>5、创建一个类</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.bean;</span><br><span class="line">public class Person &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    public Person() &#123;</span><br><span class="line">        super();</span><br><span class="line">        System.out.println(&quot;Person的空参构造方法&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //getter、setter、空参构造、toString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6、创建配置文件</strong></p>
<p>配置文件的位置和名字可以自定义，但是建议放在src下，名字为applicationContext.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line"> xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line"> xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>也可以安装spring的sts插件 </p>
<p><strong>7、配置bean对象</strong></p>
<p>在配置文件中添加bean的配置，让spring管理对象的创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<ul>
<li>bean元素：素描述需要spring容器管理的对象。</li>
<li>class属性：被管理对象的完整类名。</li>
<li>name属性：给被管理的对象起个名字，根据该名称获得对象。</li>
</ul>
<p><strong>8、测试</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.bean;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">public class IOCTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testCreatePerson()&#123;</span><br><span class="line">        </span><br><span class="line">        //1、创建容器对象</span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">        //2、在容器中找到person对象</span><br><span class="line">        Person p = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line">        //3、打印</span><br><span class="line">        System.out.println(p);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="七、什么是IoC"><a href="#七、什么是IoC" class="headerlink" title="七、什么是IoC"></a>七、什么是IoC</h3><p><strong>IoC-控制反转</strong></p>
<p>IoC是 Inverse of Control 的简写，意思是控制反转。是降低对象之间的耦合关系的设计思想。</p>
<p>通过IOC，开发人员不需要关心对象的创建过程，交给Spring容器完成。具体的过程是，程序读取Spring 配置文件，获取需要创建的 bean 对象，</p>
<p>通过反射机制创建对象的实例。</p>
<p>缺点：对象是通过反射机制实例化出来的，因此对系统的性能有一定的影响。</p>
<p><strong>DI-依赖注入</strong></p>
<p>Dependency Injection，说的是创建对象实例时，同时为这个对象注入它所依赖的属性。相当于把每个bean与bean之间的关系交给容器管理。而这个容器就是spring。</p>
<p>例如我们通常在 Service 层注入它所依赖的 Dao 层的实例；在 Controller层注入 Service层的实例。</p>
<p><strong>IoC和DI</strong></p>
<p>IoC的别名,2004年，Martin Fowler探讨了同一个问题，既然IoC是控制反转，那么到底是“哪些方面的控制被反转了呢？”，经过详细地分析和论证后，他得出了答案：“获得依赖对象的过程被反转了”。控制被反转之后，获得依赖对象的过程由自身管理对象变为由IoC容器主动注入。于是，他给“控制反转”取了一个更合适的名字叫做“依赖注入（Dependency Injection，DI）”。他的这个答案，实际上给出了实现IoC的方法：注入。</p>
<p>所谓依赖注入，就是由IoC容器在运行期间，动态地将某种依赖关系注入到对象之中。</p>
<p>所以，依赖注入（DI）和控制反转（IoC）是从不同的角度描述的同一件事情，就是指通过引入IoC容器，利用依赖关系注入的方式，实现对象之间的解耦</p>
<h3 id="八、对象创建的细节"><a href="#八、对象创建的细节" class="headerlink" title="八、对象创建的细节"></a>八、对象创建的细节</h3><p>applicationContext-bean.xml</p>
<p>BeanTest.java</p>
<p><strong>一、bean元素的id和name</strong> </p>
<p>bean元素既可以定义name属性，也可以定义id属性</p>
<p>name属性：可以重复，可以使用特殊字符。<br>id属性：作用与name属性一样。名称不可重复，不能使用特殊字符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;person1&quot; name=&quot;person2&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>以下两种方式都可以获取到上面的Person对象 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">  public void testCreatePerson()&#123;</span><br><span class="line">      ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-bean.xml&quot;);</span><br><span class="line">      Person p1 = (Person)context.getBean(&quot;person1&quot;);//方式1</span><br><span class="line">      Person p2= (Person)context.getBean(&quot;person2&quot;);//方式2</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>二、创建对象的工厂</strong> </p>
<p>1、FileSystemXmlApplicationContext：从硬盘绝对路径下加载配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testBeanFactory1()&#123;</span><br><span class="line">    ApplicationContext context = new FileSystemXmlApplicationContext(&quot;D:\\workspace\\spring-01-IOC\\src\\applicationContext-bean.xml&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、ClassPathXmlApplicationContext：丛类路径下加载配置文件 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testBeanFactory2()&#123;</span><br><span class="line">       ApplicationContext context2 = new ClassPathXmlApplicationContext(&quot;applicationContextbean-bean.xml&quot;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的测试也可以发现，默认情况下，每次容器启动时就会创建容器中配置的所有对象 </p>
<p><strong>三、单例和多例</strong></p>
<p>为bean配置scope属性</p>
<p>1、scope=”singleton”，单例， 默认值， 适用实际开发中的绝大部分情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person&quot; scope=&quot;singleton&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testScope()&#123;</span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-bean.xml&quot;);</span><br><span class="line">        Person p1 = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line">        Person p2 = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line">        System.out.println(p1==p2); //true</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>2、scope=”prototype”，多例，适用于struts2中的action的配置 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person&quot; scope=&quot;prototype&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">  public void testScope()&#123;</span><br><span class="line">      ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-bean.xml&quot;);</span><br><span class="line">      Person p1 = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line">      Person p2 = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line">      System.out.println(p1==p2); //false</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>3、scope=<em>“request”</em>（了解）：web环境下，对象与request生命周期一致。很少用。</p>
<p>4、scope=<em>“session”</em>（了解）：web环境下，对象与session生命周期一致。很少用。</p>
<p><strong>四、对象创建的时机</strong></p>
<p>scope=”singleton” 在启动容器时， 创建bean，且整个应用只有一个。</p>
<p>scope=”prototype” 在用到对象的时候，才创建对象。每次创建都是新的对象。</p>
<p><strong>五、是否延迟创建</strong> </p>
<p>注意：只对单例有效，设置scope=”singleton”时测试</p>
<p>lazy-init=”false” 默认值，不延迟创建，即在启动时候就创建对象</p>
<p>lazy-init=”true” 延迟初始化， 在用到对象的时候才创建对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person&quot; scope=&quot;singleton&quot; lazy-init=&quot;true&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"> public void testLazy()&#123;</span><br><span class="line">     ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-bean.xml&quot;);</span><br><span class="line">     //lazy-init=&quot;true&quot;，则直到执行下面的语句对象才会被创建</span><br><span class="line">     Person p = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>六、初始化/销毁</strong> </p>
<p>init-method=”init” 对应对象的init()方法，在对象创建之后执行</p>
<p>destroy-method=”destroy” 调用容器对象的destroy()方法时候执行</p>
<p>在Person类中添加初始化方法和销毁方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void init() &#123;</span><br><span class="line">        System.out.println(&quot;Person的初始化方法&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;Person的销毁方法&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>配置bean： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person&quot; init-method=&quot;init&quot; destroy-method=&quot;destroy&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<p>注意：单实例时测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testInitAndDestroy()&#123;</span><br><span class="line">       AbstractApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-bean.xml&quot;);</span><br><span class="line">       </span><br><span class="line">       //或者手动调用销毁方法</span><br><span class="line">       context.destroy();</span><br><span class="line">       //或者关闭容器，触发销毁方法</span><br><span class="line">       //context.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543915535231.png" alt="1543915535231"></p>
<h3 id="九、对象创建的几种方式"><a href="#九、对象创建的几种方式" class="headerlink" title="九、对象创建的几种方式"></a>九、对象创建的几种方式</h3><p>applicationContext-create.xml</p>
<p>CreateTest.java</p>
<p><strong>一、无参构造函数</strong></p>
<p>前面的方式调用了类的无参构造函数</p>
<p><strong>二、有参构造函数</strong></p>
<p>参考后面章节的：对象的依赖-属性注入（构造函数注入）</p>
<p><strong>三、静态工厂方法</strong></p>
<p>创建工厂类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.factory;</span><br><span class="line">import name.yaohuan.spring.bean.Person;</span><br><span class="line">public class PersonFactory &#123;</span><br><span class="line">    public static Person createPerson1()&#123;</span><br><span class="line">        System.out.println(&quot;静态工厂创建Person&quot;);</span><br><span class="line">        return new Person();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置bean： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 静态工厂创建 --&gt;</span><br><span class="line">&lt;bean name=&quot;person1&quot; class=&quot;name.yaohuan.spring.factory.PersonFactory&quot; factory-method=&quot;createPerson1&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<p>容器初始化的时候同时调用静态工厂初始化了对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testCreatePerson()&#123;</span><br><span class="line">       ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-create.xml&quot;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>四、实例工厂</strong></p>
<p> 在上一步的工厂类中添加实例工厂方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public Person createPerson2()&#123;</span><br><span class="line">    System.out.println(&quot;实例工厂创建Person&quot;);</span><br><span class="line">    return new Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置bean： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 实例工厂创建 --&gt;</span><br><span class="line">&lt;bean name=&quot;personFactory&quot; class=&quot;name.yaohuan.spring.factory.PersonFactory&quot;&gt;&lt;/bean&gt;</span><br><span class="line">&lt;bean name=&quot;person2&quot; factory-bean=&quot;personFactory&quot; factory-method=&quot;createPerson2&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<p>使用上一步的测试用例即可</p>
<h3 id="十、对象的依赖关系-依赖注入"><a href="#十、对象的依赖关系-依赖注入" class="headerlink" title="十、对象的依赖关系-依赖注入"></a>十、对象的依赖关系-依赖注入</h3><p>applicationContext-injection.xmlInjectionTest.java</p>
<p><strong>一、set方法注入</strong></p>
<p><strong>1、值类型注入使用 value</strong></p>
<p>配置bean：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- set注入 --&gt;</span><br><span class="line">&lt;bean name=&quot;person1&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;name&quot; value=&quot;helen&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;age&quot; value=&quot;18&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testProperty()&#123;</span><br><span class="line">        </span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-injection.xml&quot;);</span><br><span class="line">        Person p = (Person)context.getBean(&quot;person1&quot;);</span><br><span class="line">        System.out.println(p);    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在Person中添加 toString() 方法</p>
<p>结果：</p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543915963624.png" alt="1543915963624"></p>
<p><strong>2、引用类型注入使用</strong> <strong>ref</strong></p>
<p>创建Car.java：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.bean;</span><br><span class="line">public class Car &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private String color;</span><br><span class="line">    </span><br><span class="line">    public Car() &#123;</span><br><span class="line">        super();</span><br><span class="line">        System.out.println(&quot;Car的空参构造方法&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //getter、setter、toString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Person中引用Car： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Person &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private Car car;</span><br><span class="line">    //getter、setter、toString等</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置bean： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person1&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;</span><br><span class="line">       &lt;property name=&quot;name&quot; value=&quot;helen&quot;&gt;&lt;/property&gt;</span><br><span class="line">       &lt;property name=&quot;age&quot; value=&quot;18&quot;&gt;&lt;/property&gt;</span><br><span class="line">       &lt;property name=&quot;car&quot; ref=&quot;car&quot;&gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;bean name=&quot;car&quot; class=&quot;name.yaohuan.spring.bean.Car&quot;&gt;</span><br><span class="line">       &lt;property name=&quot;name&quot; value=&quot;MINI&quot;&gt;&lt;/property&gt;</span><br><span class="line">       &lt;property name=&quot;color&quot; value=&quot;灰色&quot; &gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testProperty()&#123;</span><br><span class="line">       </span><br><span class="line">       ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-injection.xml&quot;);</span><br><span class="line">       Person p = (Person)context.getBean(&quot;person1&quot;);</span><br><span class="line">       System.out.println(p);    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>测试：使用上一步的测试用例即可 </p>
<p><strong>二、构造函数注入</strong></p>
<p><strong>1、name属性：按参数名注入</strong></p>
<p>在Person中创建构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public Person(String name, Car car) &#123;</span><br><span class="line">        super();</span><br><span class="line">        System.out.println(&quot;Person(String name, Car car)&quot;);</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.car = car;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>配置bean：使用 <code>name</code> 属性指定参数名  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person2&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;</span><br><span class="line">     &lt;constructor-arg name=&quot;name&quot; value=&quot;helen&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">     &lt;constructor-arg name=&quot;car&quot; ref=&quot;car&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line"> &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testConstuctor()&#123;</span><br><span class="line">       ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-injection.xml&quot;);</span><br><span class="line">       Person p = (Person)context.getBean(&quot;person2&quot;);</span><br><span class="line">       System.out.println(p);    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>结果： </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543916110050.png" alt="1543916110050"></p>
<p><strong>2、index属性：按参数索引注入</strong></p>
<p>参数名一致，但位置不一致时，使用 index</p>
<p>例如以下两个构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public Person(String name, Car car) &#123;</span><br><span class="line">       super();</span><br><span class="line">       System.out.println(&quot;Person(String name, Car car)&quot;);</span><br><span class="line">       this.name = name;</span><br><span class="line">       this.car = car;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   public Person(Car car, String name) &#123;</span><br><span class="line">       super();</span><br><span class="line">       System.out.println(&quot;Person(Car car, String name)&quot;);</span><br><span class="line">       this.name = name;</span><br><span class="line">       this.car = car;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>配置bean，使用index确定调用哪个构造函数： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person2&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;</span><br><span class="line">      &lt;constructor-arg name=&quot;name&quot; value=&quot;helen&quot; index=&quot;0&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">      &lt;constructor-arg name=&quot;car&quot; ref=&quot;car&quot; index=&quot;1&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">  &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>重新执行第一步的测试用例</p>
<p>结果：</p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543916151374.png" alt="1543916151374"></p>
<p><strong>3、type属性：按参数类型注入</strong></p>
<p>参数名和位置一致，但类型不一致时，使用type</p>
<p>例如以下两个构造函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public Person(Car car, String name) &#123;</span><br><span class="line">       super();</span><br><span class="line">       System.out.println(&quot;Person(Car car, String name)&quot;);</span><br><span class="line">       this.name = name;</span><br><span class="line">       this.car = car;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   public Person(Car car, Integer name) &#123;</span><br><span class="line">       super();</span><br><span class="line">       System.out.println(&quot;Person(Car car, Integer name)&quot;);</span><br><span class="line">       this.name = name + &quot;&quot;;</span><br><span class="line">       this.car = car;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>配置bean，使用type指定参数的类型 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person2&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;&gt;</span><br><span class="line">       &lt;constructor-arg name=&quot;name&quot; value=&quot;988&quot; type=&quot;java.lang.Integer&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">       &lt;constructor-arg name=&quot;car&quot; ref=&quot;car&quot; &gt;&lt;/constructor-arg&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>重新执行第一步的测试用例</p>
<p>结果：</p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543916191914.png" alt="1543916191914"></p>
<p><strong>三、p名称空间注入</strong></p>
<p>导入p名称空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br></pre></td></tr></table></figure>
<p>使用 p:属性名 完成注入，走set方法</p>
<ul>
<li><p>值类型：p:属性名=”值”</p>
</li>
<li><p>对象类型：p:属性名-ref=”bean名称”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person3&quot; class=&quot;name.yaohuan.spring.bean.Person&quot; </span><br><span class="line">      p:name=&quot;helen&quot; p:age=&quot;18&quot; p:car-ref=&quot;car&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testP()&#123;</span><br><span class="line">       ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-injection.xml&quot;);</span><br><span class="line">       Person p = (Person)context.getBean(&quot;person3&quot;);</span><br><span class="line">       System.out.println(p);    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>结果： </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543916271031.png" alt="1543916271031"></p>
<p><strong>四、spel注入</strong></p>
<p>spring Expression Language：spring表达式语言</p>
<p>bean配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;person4&quot; class=&quot;name.yaohuan.spring.bean.Person&quot; &gt;</span><br><span class="line">        &lt;property name=&quot;name&quot; value=&quot;#&#123;person1.name&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;age&quot; value=&quot;#&#123;person1.age&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;car&quot; ref=&quot;car&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testSpel()&#123;</span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-injection.xml&quot;);</span><br><span class="line">        Person p = (Person)context.getBean(&quot;person4&quot;);</span><br><span class="line">        System.out.println(p);    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>结果： </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543916315901.png" alt="1543916315901"></p>
<h3 id="十一、对象的依赖关系-复杂类型注入"><a href="#十一、对象的依赖关系-复杂类型注入" class="headerlink" title="十一、对象的依赖关系-复杂类型注入"></a>十一、对象的依赖关系-复杂类型注入</h3><p>applicationContext-collection.xml</p>
<p>CollectionTest.java</p>
<p>实体类： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.bean;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">public class CollectionBean &#123;</span><br><span class="line">    private Object[] arr;//数组类型注入</span><br><span class="line">    private List list;//list/set 类型注入</span><br><span class="line">    private Map map;//map类型注入</span><br><span class="line">    private Properties prop;//properties类型注入</span><br><span class="line">    //getter、setter、空参构造、toString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>一、数组注入</strong></p>
<p>1、如果数组中只准备注入一个 值 | 对象，直接使用 value | ref 即可 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;car&quot; class=&quot;name.yaohuan.spring.bean.Car&quot;&gt;</span><br><span class="line">       &lt;property name=&quot;name&quot; value=&quot;MINI&quot;&gt;&lt;/property&gt;</span><br><span class="line">       &lt;property name=&quot;color&quot; value=&quot;灰色&quot; &gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;!-- 数组注入 --&gt;</span><br><span class="line">   &lt;bean name=&quot;cb1&quot; class=&quot;name.yaohuan.spring.bean.CollectionBean&quot; &gt;</span><br><span class="line">       &lt;!-- 如果数组中只准备注入一个值(对象)，直接使用value|ref即可 --&gt;</span><br><span class="line">       &lt;property name=&quot;arr&quot; value=&quot;helen&quot; &gt;&lt;/property&gt;</span><br><span class="line">       &lt;!-- &lt;property name=&quot;arr&quot; ref=&quot;car&quot; &gt;&lt;/property&gt; --&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>2、多个数组元素 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;cb2&quot; class=&quot;name.yaohuan.spring.bean.CollectionBean&quot; &gt;</span><br><span class="line">      &lt;!-- array注入,多个元素注入 --&gt;</span><br><span class="line">      &lt;property name=&quot;arr&quot;&gt;</span><br><span class="line">          &lt;array&gt;</span><br><span class="line">              &lt;value&gt;tom&lt;/value&gt;</span><br><span class="line">              &lt;value&gt;helen&lt;/value&gt;</span><br><span class="line">              &lt;ref bean=&quot;car&quot; /&gt;</span><br><span class="line">          &lt;/array&gt;</span><br><span class="line">      &lt;/property&gt;</span><br><span class="line">  &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p><strong>二、List注入</strong></p>
<p>1、如果集合中只准备注入一个值(对象),直接使用value|ref即可 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;cb3&quot; class=&quot;name.yaohuan.spring.bean.CollectionBean&quot; &gt;</span><br><span class="line">       &lt;!-- 如果List中只准备注入一个值(对象),直接使用value|ref即可 --&gt;</span><br><span class="line">       &lt;property name=&quot;list&quot; value=&quot;helen&quot; &gt;&lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>2、多个集合元素 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;cb4&quot; class=&quot;name.yaohuan.spring.bean.CollectionBean&quot; &gt;</span><br><span class="line">        &lt;property name=&quot;list&quot;  &gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;helen&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;rose&lt;/value&gt;</span><br><span class="line">                &lt;ref bean=&quot;car&quot; /&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p><strong>三、Map注入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;cb5&quot; class=&quot;name.yaohuan.spring.bean.CollectionBean&quot; &gt;</span><br><span class="line">       &lt;property name=&quot;map&quot;  &gt;</span><br><span class="line">           &lt;map&gt;</span><br><span class="line">               &lt;entry key=&quot;username&quot; value=&quot;root&quot; &gt;&lt;/entry&gt;</span><br><span class="line">               &lt;entry key=&quot;car&quot; value-ref=&quot;car&quot;  &gt;&lt;/entry&gt;</span><br><span class="line">               &lt;entry key-ref=&quot;car&quot; value-ref=&quot;car&quot;  &gt;&lt;/entry&gt;</span><br><span class="line">           &lt;/map&gt; </span><br><span class="line">       &lt;/property&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p><strong>四、properties类型注入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=&quot;cb6&quot; class=&quot;name.yaohuan.spring.bean.CollectionBean&quot; &gt;</span><br><span class="line">      &lt;property name=&quot;prop&quot;&gt;</span><br><span class="line">          &lt;props&gt;</span><br><span class="line">              &lt;prop key=&quot;driverClass&quot;&gt;com.jdbc.mysql.Driver&lt;/prop&gt;</span><br><span class="line">              &lt;prop key=&quot;userName&quot;&gt;root&lt;/prop&gt;</span><br><span class="line">              &lt;prop key=&quot;password&quot;&gt;123456&lt;/prop&gt;</span><br><span class="line">          &lt;/props&gt;</span><br><span class="line">      &lt;/property&gt;</span><br><span class="line">  &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="十二、使用注解"><a href="#十二、使用注解" class="headerlink" title="十二、使用注解"></a>十二、使用注解</h3><p><strong>1、创建项目</strong></p>
<p>spring-02-annotation</p>
<p><strong>2、引入jar包</strong></p>
<p>核心包加日志包（和之前一样）</p>
<p>加 spring-aop 包</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/6cb3f82b-e283-418f-86a4-6fa802fd138b/index_files/1506670153213.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543916664046.png" alt="1543916664046"></p>
<p>maven项目无需添加新包，context依赖了aop。完整的依赖如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring --&gt;</span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line">   &lt;!-- 日志处理 --&gt;</span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、引入日志配置</strong></p>
<p>log4j.properties</p>
<p><strong>4、创建实体类</strong></p>
<p>Person.java：保留基本空参构造方法和getter、setter即可</p>
<p>Car.java</p>
<p><strong>5、创建applicationContext.xml</strong></p>
<p>引入新的名称空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">xmlns=&quot;http://www.springframework.org/schema/beans&quot; </span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot; </span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/context </span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p><strong>6、配置注解扫描</strong></p>
<p>指定扫描name.yaohuan.spring.bean下的所有类中的注解。</p>
<p>扫描包时，会扫描所有子孙包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;name.yaohuan.spring.bean&quot;&gt;&lt;/context:component-scan&gt;</span><br></pre></td></tr></table></figure>
<p><strong>7、在类中使用注解</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;person&quot;)</span><br><span class="line">//&lt;bean name=&quot;person&quot; class=&quot;name.yaohuan.spring.bean.Person&quot;  /&gt;</span><br><span class="line">public class Person &#123;</span><br></pre></td></tr></table></figure>
<p><strong>8、测试</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class AnnotationTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testCreatePerson()&#123;</span><br><span class="line">        </span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">        Person p = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line">        System.out.println(p);    </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>9、其他类的头部可用的注解</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Service(&quot;person&quot;) // service层</span><br><span class="line">@Controller(&quot;person&quot;) // controller层</span><br><span class="line">@Repository(&quot;person&quot;)// dao层</span><br></pre></td></tr></table></figure>
<p><strong>10、在类的头部指定对象的作用域</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Scope(scopeName=&quot;singleton&quot;)</span><br><span class="line">@Scope(scopeName=&quot;prototype&quot;)</span><br></pre></td></tr></table></figure>
<p><strong>11、注入属性value值</strong></p>
<p>加在成员变量上：通过反射的Field赋值（破坏对象的封装性）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;helen&quot;)</span><br><span class="line">  private String name;</span><br></pre></td></tr></table></figure>
<p>或加在set方法上：通过set方法赋值 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;tom&quot;)</span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>@Value(“helen”) 等同于 @Value(value=”helen”) </p>
<p><strong>12、自动装配</strong></p>
<p>（1）@Autowired</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;car&quot;)</span><br><span class="line">public class Car &#123;</span><br><span class="line">    @Value(&quot;mini&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @Value(&quot;红&quot;)</span><br><span class="line">    private String color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;person&quot;)</span><br><span class="line">public class Person &#123;</span><br><span class="line">    @Value(&quot;helen&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @Value(&quot;18&quot;)</span><br><span class="line">    private Integer age;</span><br><span class="line">    @Autowired</span><br><span class="line">    private Car car;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>（2）@Qualifier</strong></p>
<ul>
<li>如果匹配多个类型一致的对象，将无法选择具体注入哪一个对象</li>
<li>使用@Qualifier()注解告诉spring容器自动装配哪个名称的对象</li>
</ul>
<p>创建Computer接口和PC、Labtop实现类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public interface Computer &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;pc&quot;)</span><br><span class="line">public class PC implements Computer&#123;</span><br><span class="line">    @Value(&quot;联想台式机&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    //getter、setter、空参构造、toString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;labtop&quot;)</span><br><span class="line">public class Labtop implements Computer&#123;</span><br><span class="line">    @Value(&quot;苹果笔记本&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    //getter、setter、空参构造、toString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Person类中添加Computer属性：使用 <code>@Qualifier(&quot;labtop&quot;)</code> 指定装配 <code>@Component(&quot;labtop&quot;)</code> 对象 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">  @Qualifier(&quot;labtop&quot;)</span><br><span class="line">  private Computer computer;</span><br><span class="line">  //getter、setter</span><br></pre></td></tr></table></figure>
<p><strong>（3）@Resource</strong></p>
<p>使用@Resource指定注入哪个名称的对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Resource(name=&quot;pc&quot;)</span><br><span class="line"> private Computer computer;</span><br></pre></td></tr></table></figure>
<p><strong>13、初始化和销毁方法</strong></p>
<p>注意：单实例时设置</p>
<p>person类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@PostConstruct //在对象被创建后调用，init-method</span><br><span class="line">  public void init() &#123;</span><br><span class="line">      System.out.println(&quot;Person的初始化方法&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  @PreDestroy //在销毁之前调用，destory-method</span><br><span class="line">  public void destroy() &#123;</span><br><span class="line">      System.out.println(&quot;Person的销毁方法&quot;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testInitAndDestroy()&#123;</span><br><span class="line">        AbstractApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">        //或者手动调用销毁方法</span><br><span class="line">        context.destroy();</span><br><span class="line">        //或者关闭容器，触发销毁方法</span><br><span class="line">        //context.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="十三、spring整合junit测试"><a href="#十三、spring整合junit测试" class="headerlink" title="十三、spring整合junit测试"></a>十三、spring整合junit测试</h3><p>spring整合junit，为我们提供了方便的测试方式</p>
<p><strong>1、导包</strong></p>
<p>在spring-02-annotation项目中再加入如下包</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/ad1dae3e-ccac-4aa0-898c-df22005862af/index_files/1506674560367.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543917070793.png" alt="1543917070793"></p>
<p>pom：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>完整的依赖如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring --&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">         &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">     &lt;/dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class="line">         &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">     &lt;/dependency&gt;</span><br><span class="line">     &lt;!-- 日志处理 --&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">         &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">     &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>2、创建测试类</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//创建容器</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">//指定创建容器时使用哪个配置文件</span><br><span class="line">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="line">public class RunWithTest &#123;</span><br><span class="line">    //将名为user的对象注入到u变量中</span><br><span class="line">    @Resource(name=&quot;person&quot;)</span><br><span class="line">    private Person p;</span><br><span class="line">    @Test</span><br><span class="line">    public void testCreatePerson()&#123;</span><br><span class="line">        System.out.println(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十四、aop简介"><a href="#十四、aop简介" class="headerlink" title="十四、aop简介"></a>十四、aop简介</h3><p><strong>1、AOP （面向切面编程）</strong></p>
<p>在软件业，AOP为Aspect Oriented Programming的缩写，意为：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。AOP是OOP的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<p>AOP 思想：横向重复、纵向抽取</p>
<p><strong>2、底层实现：</strong></p>
<p>Spring 的 AOP 的底层用到两种代理机制：</p>
<ul>
<li>JDK 的动态代理：针对实现了接口的类产生代理。</li>
<li>Cglib 的动态代理：针对没有实现接口的类产生代理，应用的是底层的字节码增强的技术 生成当前类的子类对象。</li>
</ul>
<p><strong>3、AOP 的开发中的相关术语：</strong></p>
<ul>
<li><strong>Joinpoint（连接点）：</strong>所谓连接点是指那些被拦截到的点。在 spring 中，这些点指的是方法,因为 spring 只支持方法类型的连接点（可以被切入的点）</li>
<li><strong>Pointcut（切入点）：</strong>所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义。（已经被切入的点）</li>
<li><strong>Advice（通知/增强）：</strong>所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知。通知分为前置通知，后置通知，异常通知，最终通知，环绕通知（切面要完成的功能）</li>
<li><strong>Introduction（引介）：</strong>引介是一种特殊的通知在不修改类代码的前提下，Introduction 可以在运行期为类动态地添加一些方法或 Field。</li>
<li><strong>Aspect（切面）：</strong>是切入点和通知（引介）的结合</li>
<li><strong>Target（目标对象）：</strong>代理的目标对象</li>
<li><strong>Proxy（代理）：</strong>一个类被 AOP 织入增强后，就产生一个结果代理类。</li>
<li><strong>Weaving(织入)：</strong>是指把增强应用到目标对象来创建新的代理对象的过程。spring 采用动态代理织入，而 AspectJ 采用编译期织入和类装载期织入。</li>
</ul>
<h3 id="十五、spring-aop-开发（xml）"><a href="#十五、spring-aop-开发（xml）" class="headerlink" title="十五、spring aop 开发（xml）"></a><strong>十五、spring aop 开发（xml）</strong></h3><p><strong>1、创建项目</strong></p>
<p>spring-03-aop</p>
<p><strong>2、引入jar包</strong></p>
<p>核心包加日志包（和之前一样）</p>
<p>测试包</p>
<p>再加入以下包</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/d08b8a35-9040-4a50-9dd6-7f7f0cfcb6e2/index_files/9d92a743-8734-47f0-b964-48b751c11754.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543917244233.png" alt="1543917244233"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>完整的依赖如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!-- 日志处理 --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、引入日志配置</strong></p>
<p>log4j.properties</p>
<p><strong>4、准备目标对象</strong></p>
<p>先创建UserService接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.service;</span><br><span class="line">public interface UserService &#123;</span><br><span class="line">    void save();</span><br><span class="line">    void delete();</span><br><span class="line">    void update();</span><br><span class="line">    void select();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现类： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.service;</span><br><span class="line">public class UserServiceImpl implements UserService &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void save() &#123;</span><br><span class="line">        System.out.println(&quot;保存用户!&quot;);</span><br><span class="line">        //int i = 1/0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void delete() &#123;</span><br><span class="line">        System.out.println(&quot;删除用户!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void update() &#123;</span><br><span class="line">        System.out.println(&quot;更新用户!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void select() &#123;</span><br><span class="line">        System.out.println(&quot;查找用户!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5、准备通知</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.aop;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">//通知类</span><br><span class="line">public class MyAdvice &#123;</span><br><span class="line">    </span><br><span class="line">    //前置通知：目标方法运行之前调用</span><br><span class="line">    //后置通知(如果出现异常不会调用)：在目标方法运行之后调用</span><br><span class="line">    //环绕通知：在目标方法之前和之后都调用</span><br><span class="line">    //异常拦截通知：如果出现异常，就会调用</span><br><span class="line">    //后置通知(无论是否出现 异常都会调用)：在目标方法运行之后调用</span><br><span class="line">    //前置通知</span><br><span class="line">    public void before()&#123;</span><br><span class="line">        System.out.println(&quot;这是前置通知!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //后置通知</span><br><span class="line">    public void afterReturning()&#123;</span><br><span class="line">        System.out.println(&quot;这是后置通知(如果出现异常不会调用)!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //环绕通知</span><br><span class="line">    public Object around(ProceedingJoinPoint pjp) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;这是环绕通知之前的部分!!&quot;);</span><br><span class="line">        Object proceed = pjp.proceed();//调用目标方法</span><br><span class="line">        System.out.println(&quot;这是环绕通知之后的部分!!&quot;);</span><br><span class="line">        return proceed;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //异常通知</span><br><span class="line">    public void afterException()&#123;</span><br><span class="line">        System.out.println(&quot;出事啦!出现异常了!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //后置通知</span><br><span class="line">    public void after()&#123;</span><br><span class="line">        System.out.println(&quot;这是后置通知(出现异常也会调用)!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6、配置进行织入,将通知织入目标对象中</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">xmlns=&quot;http://www.springframework.org/schema/beans&quot; </span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot; </span><br><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; </span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/context </span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/aop </span><br><span class="line">http://www.springframework.org/schema/aop/spring-aop-4.2.xsd &quot;&gt;</span><br><span class="line">&lt;!-- 准备工作: 导入aop(约束)命名空间 --&gt;</span><br><span class="line">&lt;!-- 1.配置目标对象 --&gt;</span><br><span class="line">    &lt;bean name=&quot;userService&quot; class=&quot;name.yaohuan.spring.service.UserServiceImpl&quot; &gt;&lt;/bean&gt;</span><br><span class="line">&lt;!-- 2.配置通知对象 --&gt;</span><br><span class="line">    &lt;bean name=&quot;myAdvice&quot; class=&quot;name.yaohuan.spring.aop.MyAdvice&quot; &gt;&lt;/bean&gt;</span><br><span class="line">&lt;!-- 3.配置将通知织入目标对象 --&gt;</span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;!-- 配置切入点 </span><br><span class="line">            public void name.yaohuan.spring.service.UserServiceImpl.save() </span><br><span class="line">            * name.yaohuan.spring.service.UserServiceImpl.*()</span><br><span class="line">            * name.yaohuan.spring.service.*ServiceImpl.*(..)</span><br><span class="line">            * name.yaohuan.spring.service..*ServiceImpl.*(..)</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;aop:pointcut expression=&quot;execution(* name.yaohuan.spring.service.*ServiceImpl.*(..))&quot; id=&quot;pc&quot;/&gt;</span><br><span class="line">        &lt;aop:aspect ref=&quot;myAdvice&quot; &gt;</span><br><span class="line">            &lt;!-- 指定名为before方法作为前置通知 --&gt;</span><br><span class="line">            &lt;aop:before method=&quot;before&quot; pointcut-ref=&quot;pc&quot; /&gt;</span><br><span class="line">            &lt;!-- 后置 --&gt;</span><br><span class="line">            &lt;aop:after-returning method=&quot;afterReturning&quot; pointcut-ref=&quot;pc&quot; /&gt;</span><br><span class="line">            &lt;!-- 环绕通知 --&gt;</span><br><span class="line">            &lt;aop:around method=&quot;around&quot; pointcut-ref=&quot;pc&quot; /&gt;</span><br><span class="line">            &lt;!-- 异常拦截通知 --&gt;</span><br><span class="line">            &lt;aop:after-throwing method=&quot;afterException&quot; pointcut-ref=&quot;pc&quot;/&gt;</span><br><span class="line">            &lt;!-- 后置 --&gt;</span><br><span class="line">            &lt;aop:after method=&quot;after&quot; pointcut-ref=&quot;pc&quot;/&gt;</span><br><span class="line">        &lt;/aop:aspect&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p><strong>7、测试</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.service;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.test.context.ContextConfiguration;</span><br><span class="line">import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="line">public class AopTest &#123;</span><br><span class="line">    </span><br><span class="line">    @Resource(name=&quot;userService&quot;)</span><br><span class="line">    private UserService userService;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testSave()&#123;</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十六、spring-aop-开发（注解）"><a href="#十六、spring-aop-开发（注解）" class="headerlink" title="十六、spring aop 开发（注解）"></a>十六、spring aop 开发（注解）</h3><p>1、按照前面的步骤中准备目标对象和通知</p>
<p>2、配置文件</p>
<p>配置目标对象</p>
<p>配置通知对象</p>
<p>开启注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 3.开启使用注解完成织入 --&gt;</span><br><span class="line">&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</span><br></pre></td></tr></table></figure>
<p>7、MyAdvice中加注解 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//通知类</span><br><span class="line">@Aspect</span><br><span class="line">//表示该类是一个通知类</span><br><span class="line">public class MyAdvice &#123;</span><br><span class="line">    @Pointcut(&quot;execution(* name.yaohuan.spring.service.*ServiceImpl.*(..))&quot;)</span><br><span class="line">    public void pc()&#123;&#125;</span><br><span class="line">    //前置通知</span><br><span class="line">    //指定该方法是前置通知,并制定切入点</span><br><span class="line">    @Before(&quot;MyAdvice.pc()&quot;)</span><br><span class="line">    public void before()&#123;</span><br><span class="line">        System.out.println(&quot;这是前置通知!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //后置通知</span><br><span class="line">    @AfterReturning(&quot;execution(* name.yaohuan.spring.service.*ServiceImpl.*(..))&quot;)</span><br><span class="line">    public void afterReturning()&#123;</span><br><span class="line">        System.out.println(&quot;这是后置通知(如果出现异常不会调用)!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //环绕通知</span><br><span class="line">    @Around(&quot;execution(* name.yaohuan.spring.service.*ServiceImpl.*(..))&quot;)</span><br><span class="line">    public Object around(ProceedingJoinPoint pjp) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;这是环绕通知之前的部分!!&quot;);</span><br><span class="line">        Object proceed = pjp.proceed();//调用目标方法</span><br><span class="line">        System.out.println(&quot;这是环绕通知之后的部分!!&quot;);</span><br><span class="line">        return proceed;</span><br><span class="line">    &#125;</span><br><span class="line">    //异常通知</span><br><span class="line">    @AfterThrowing(&quot;execution(* name.yaohuan.spring.service.*ServiceImpl.*(..))&quot;)</span><br><span class="line">    public void afterException()&#123;</span><br><span class="line">        System.out.println(&quot;出事啦!出现异常了!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //后置通知</span><br><span class="line">    @After(&quot;execution(* name.yaohuan.spring.service.*ServiceImpl.*(..))&quot;)</span><br><span class="line">    public void after()&#123;</span><br><span class="line">        System.out.println(&quot;这是后置通知(出现异常也会调用)!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十七、JdbcTemplate入门"><a href="#十七、JdbcTemplate入门" class="headerlink" title="十七、JdbcTemplate入门"></a>十七、JdbcTemplate入门</h3><p><strong>类似DBUtils 的 QueryRunner</strong></p>
<p><strong>案例：救援系统的角色表的增删改查</strong></p>
<p><strong>1、创建项目</strong></p>
<p>spring-04-jdbcTemplate</p>
<p><strong>2、导包</strong></p>
<p>核心包加日志包（和之前一样）</p>
<p>测试包</p>
<p>再加入以下jar包</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/2c08cf77-2d85-41b0-a184-66e9bc6ad461/index_files/4b6eb9a0-64f2-4f61-9360-1242f24e367a.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543917595463.png" alt="1543917595463"></p>
<p>完整的依赖如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">              &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!-- 日志处理 --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!-- mysql --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;5.1.40&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;!-- c3p0 --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;0.9.5.2&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、引入日志配置</strong></p>
<p>log4j.properties</p>
<p><strong>4、数据库</strong></p>
<p>新建数据库spring，创建角色表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/*Table structure for table `ar_role` */</span><br><span class="line"></span><br><span class="line">CREATE TABLE `ar_role` (</span><br><span class="line">  `rid` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT &apos;角色id&apos;,</span><br><span class="line">  `rname` varchar(20) NOT NULL COMMENT &apos;角色名&apos;,</span><br><span class="line">  `alias` varchar(20) NOT NULL COMMENT &apos;角色别名&apos;,</span><br><span class="line">  PRIMARY KEY (`rid`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">/*Data for the table `ar_role` */</span><br><span class="line"></span><br><span class="line">insert  into `ar_role`(`rid`,`rname`,`alias`) values (1,&apos;administrator&apos;,&apos;系统管理员&apos;);</span><br><span class="line">insert  into `ar_role`(`rid`,`rname`,`alias`) values (2,&apos;dispatcher&apos;,&apos;调度员&apos;);</span><br></pre></td></tr></table></figure>
<p><strong>5、拷贝之前写的 DataSourceUtil.java</strong></p>
<p><strong>6、拷贝c3p0-config.xml</strong></p>
<p><strong>7、写测试类</strong></p>
<p>下面是不使用 DataSourceUtil.java 的版本，和使用 DataSourceUtil.java 的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.jdbctemplate;</span><br><span class="line">public class JdbcTemplateTest &#123;</span><br><span class="line">    </span><br><span class="line">    //不使用工具类</span><br><span class="line">    @Test</span><br><span class="line">    public void testSave1() throws PropertyVetoException&#123;</span><br><span class="line">        </span><br><span class="line">        //准备连接池</span><br><span class="line">        ComboPooledDataSource dataSource = new ComboPooledDataSource();</span><br><span class="line">        dataSource.setDriverClass(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">        dataSource.setJdbcUrl(&quot;jdbc:mysql://localhost:3306/spring&quot;);</span><br><span class="line">        dataSource.setUser(&quot;root&quot;);</span><br><span class="line">        dataSource.setPassword(&quot;123456&quot;);</span><br><span class="line">        </span><br><span class="line">        //创建JdbcTemplate对象</span><br><span class="line">        JdbcTemplate jt= new JdbcTemplate(dataSource);</span><br><span class="line">        //执行sql</span><br><span class="line">        String sql = &quot; INSERT INTO ar_role ( &quot;</span><br><span class="line">                + &quot; rname,&quot;</span><br><span class="line">                + &quot; alias&quot;</span><br><span class="line">                + &quot; ) VALUES (?,?)&quot; ;</span><br><span class="line">       jt.update(sql, &quot;test1&quot;, &quot;test1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //使用工具类</span><br><span class="line">    @Test</span><br><span class="line">    public void testSave2() throws PropertyVetoException&#123;</span><br><span class="line">        </span><br><span class="line">        //准备连接池</span><br><span class="line">        DataSource dataSource = DataSourceUtil.getDataSource();</span><br><span class="line">        //创建JdbcTemplate对象</span><br><span class="line">        JdbcTemplate jt= new JdbcTemplate(dataSource);</span><br><span class="line">        //执行sql</span><br><span class="line">        String sql = &quot; INSERT INTO ar_role ( &quot;</span><br><span class="line">                + &quot; rname,&quot;</span><br><span class="line">                + &quot; alias&quot;</span><br><span class="line">                + &quot; ) VALUES (?,?)&quot; ;</span><br><span class="line">       jt.update(sql, &quot;test2&quot;, &quot;test2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十八、用spring管理JdbcTemplate"><a href="#十八、用spring管理JdbcTemplate" class="headerlink" title="十八、用spring管理JdbcTemplate"></a>十八、用spring管理JdbcTemplate</h3><p>学习JdbcTemplate API 和 如何用Spring 管理 JdbcTemplate</p>
<p><strong>1、创建 pojo.Role.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.pojo;</span><br><span class="line">public class Role &#123;</span><br><span class="line">    private Integer rid;</span><br><span class="line">    private String rname;</span><br><span class="line">    private String alias;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2、创建 dao.RoleDao.java 和 dao.RoleDaoImpl.java</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.dao;</span><br><span class="line">public interface RoleDao &#123;</span><br><span class="line">    //增</span><br><span class="line">    void save(Role role);</span><br><span class="line">    //删</span><br><span class="line">    void delete(Integer id);</span><br><span class="line">    //改</span><br><span class="line">    void update(Role role);</span><br><span class="line">    //查</span><br><span class="line">    Role getById(Integer id);</span><br><span class="line">    //查</span><br><span class="line">    int getTotalCount();</span><br><span class="line">    //查</span><br><span class="line">    List&lt;Role&gt; getAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将数据源（连接池）、JdbcTemplate、RoleDao对象交给spring容器管理</p>
<p>如果不用注解的方式配置，不要忘记写jt的 set 方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.dao;</span><br><span class="line">public class RoleDaoImpl extends JdbcDaoSupport implements RoleDao &#123;</span><br><span class="line">    </span><br><span class="line">    private JdbcTemplate jt;</span><br><span class="line">    public void setJt(JdbcTemplate jt) &#123;</span><br><span class="line">        this.jt = jt;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void save(Role role) &#123;</span><br><span class="line">        String sql = &quot; INSERT INTO ar_role ( &quot;</span><br><span class="line">                + &quot; rname,&quot;</span><br><span class="line">                + &quot; alias&quot;</span><br><span class="line">                + &quot; ) VALUES (?,?)&quot; ;</span><br><span class="line">        jt.update(sql, role.getRname(), role.getAlias());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void delete(Integer id) &#123;</span><br><span class="line">        String sql = &quot;delete from ar_role where rid = ? &quot;;</span><br><span class="line">        jt.update(sql, id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void update(Role role) &#123;</span><br><span class="line">        String sql = &quot;update ar_role set rname = ?, alias = ? where rid=? &quot;;</span><br><span class="line">        jt.update(sql, role.getRname(), role.getAlias(), role.getRid());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public Role getById(Integer id) &#123;</span><br><span class="line">        String sql = &quot;select * from ar_role where rid = ? &quot;;</span><br><span class="line">        return jt.queryForObject(sql,new RowMapper&lt;Role&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Role mapRow(ResultSet rs, int index) throws SQLException &#123;</span><br><span class="line">                return mapRowHandler(rs);</span><br><span class="line">            &#125;&#125;, id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public int getTotalCount() &#123;</span><br><span class="line">        String sql = &quot;select count(*) from ar_role &quot;;</span><br><span class="line">        Integer count = jt.queryForObject(sql, Integer.class);</span><br><span class="line">        return count;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Role&gt; getAll() &#123;</span><br><span class="line">        String sql = &quot;select * from ar_role&quot;;</span><br><span class="line">        List&lt;Role&gt; list = jt.query(sql, new RowMapper&lt;Role&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Role mapRow(ResultSet rs, int index) throws SQLException &#123;</span><br><span class="line">                return mapRowHandler(rs);</span><br><span class="line">            &#125;&#125;);</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line">    private Role mapRowHandler(ResultSet rs) throws SQLException &#123;</span><br><span class="line">        Role role = new Role();</span><br><span class="line">        role.setRname(rs.getString(&quot;rname&quot;));</span><br><span class="line">        role.setAlias(rs.getString(&quot;alias&quot;));</span><br><span class="line">        role.setRid(rs.getInt(&quot;rid&quot;));</span><br><span class="line">        return role;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3、创建db.properties</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.jdbcUrl=jdbc:mysql://localhost:3306/spring</span><br><span class="line">jdbc.driverClass=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.user=root</span><br><span class="line">jdbc.password=123456</span><br></pre></td></tr></table></figure>
<p><strong>4、配置applicationContext.xml</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">xmlns=&quot;http://www.springframework.org/schema/beans&quot; </span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;  </span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/context </span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd &quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 指定spring读取db.properties配置 --&gt;</span><br><span class="line">&lt;context:property-placeholder location=&quot;classpath:db.properties&quot;  /&gt;</span><br><span class="line">&lt;!-- 1、连接池 --&gt;</span><br><span class="line">&lt;bean name=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; &gt;</span><br><span class="line">    &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.jdbcUrl&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!-- 2、JdbcTemplate --&gt;</span><br><span class="line">&lt;bean name=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; &gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; &gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!-- 3、roleDao --&gt;</span><br><span class="line">&lt;bean name=&quot;roleDao&quot; class=&quot;name.yaohuan.spring.dao.RoleDaoImpl&quot; &gt;</span><br><span class="line">    &lt;property name=&quot;jt&quot; ref=&quot;jdbcTemplate&quot; &gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p><strong>5、写测试类</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.jdbctemplate;</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="line">public class SpringJdbcTemplateTest &#123;</span><br><span class="line">    @Resource(name=&quot;roleDao&quot;)</span><br><span class="line">    private RoleDao roleDao;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testSave() throws Exception&#123;</span><br><span class="line">        Role role = new Role();</span><br><span class="line">        role.setRname(&quot;spring1&quot;);</span><br><span class="line">        role.setAlias(&quot;spring1&quot;);</span><br><span class="line">        roleDao.save(role);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testDelete() throws Exception&#123;</span><br><span class="line">        roleDao.delete(11);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate() throws Exception&#123;</span><br><span class="line">        Role role = new Role();</span><br><span class="line">        role.setRid(10);</span><br><span class="line">        role.setRname(&quot;spring123&quot;);</span><br><span class="line">        role.setAlias(&quot;spring123&quot;);</span><br><span class="line">        roleDao.update(role);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testGetById() throws Exception&#123;</span><br><span class="line">        System.out.println(roleDao.getById(1));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testGetTotalCount() throws Exception&#123;</span><br><span class="line">        System.out.println(roleDao.getTotalCount());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testGetAll() throws Exception&#123;</span><br><span class="line">        System.out.println(roleDao.getAll());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6、也可以使用注解的方式</strong> </p>
<p>（1）在applicationContext中配置注解扫描 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;name.yaohuan.spring.dao&quot;&gt;&lt;/context:component-scan&gt;</span><br></pre></td></tr></table></figure>
<p>（2）不用配置  &lt;bean name=”roleDao” …</p>
<p>（3）在 RoleDaoImpl中配置注解</p>
<p>此时已经不需要 jt 的 set 方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Repository(&quot;roleDao&quot;)</span><br><span class="line">public class RoleDaoImpl implements RoleDao &#123;</span><br><span class="line">    </span><br><span class="line">    @Resource(name=&quot;jdbcTemplate&quot;)</span><br><span class="line">    private JdbcTemplate jt;</span><br></pre></td></tr></table></figure>
<p>（4）执行刚才的测试用例即可 </p>
<h3 id="十九、转账的案例（无事务）"><a href="#十九、转账的案例（无事务）" class="headerlink" title="十九、转账的案例（无事务）"></a>十九、转账的案例（无事务）</h3><p><strong>案例：转账</strong></p>
<p><strong>1、创建项目</strong></p>
<p>spring-05-tx</p>
<p><strong>2、导包</strong></p>
<p>同 前一个项目 spring-04-jdbcTemplate，再加上aop的相关包</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/280ef5a3-00eb-4cf3-81f7-d21e96dff286/index_files/aa6200ac-68f1-4f63-bc2f-03add670ff26.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543917868911.png" alt="1543917868911"></p>
<p>完整的依赖如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- 日志处理 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- mysql --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;5.1.40&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- c3p0 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.9.5.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、引入日志配置</strong></p>
<p>log4j.properties</p>
<p><strong>4、复制数据库配置</strong></p>
<p>db.properties</p>
<p><strong>5、创建数据库表</strong></p>
<p>在spring数据库中创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/*Table structure for table `ar_account` */</span><br><span class="line"></span><br><span class="line">CREATE TABLE `ar_account` (</span><br><span class="line">  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `username` VARCHAR(20) NOT NULL,</span><br><span class="line">  `money` DECIMAL(10,2) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=INNODB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">/*Data for the table `ar_account` */</span><br><span class="line"></span><br><span class="line">INSERT  INTO `ar_account`(`id`,`username`,`money`) VALUES (1,&apos;Helen&apos;,&apos;1000.00&apos;);</span><br><span class="line">INSERT  INTO `ar_account`(`id`,`username`,`money`) VALUES (2,&apos;Tom&apos;,&apos;1000.00&apos;);</span><br></pre></td></tr></table></figure>
<p><strong>6、创建dao接口和dao</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.dao;</span><br><span class="line">public interface AccountDao &#123;</span><br><span class="line">    //加钱</span><br><span class="line">    void increaseMoney(Integer id,Double money);</span><br><span class="line">    //减钱</span><br><span class="line">    void decreaseMoney(Integer id,Double money);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.dao;</span><br><span class="line">@Repository(&quot;accountDao&quot;)</span><br><span class="line">public class AccountDaoImpl implements AccountDao  &#123;</span><br><span class="line">    @Resource(name=&quot;jdbcTemplate&quot;)</span><br><span class="line">    private JdbcTemplate jt;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void increaseMoney(Integer id, Double money) &#123;</span><br><span class="line">        jt.update(&quot;update ar_account set money = money+? where id = ? &quot;, money,id);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void decreaseMoney(Integer id, Double money) &#123;</span><br><span class="line">        jt.update(&quot;update ar_account set money = money-? where id = ? &quot;, money,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>7、创建service接口和service</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.service;</span><br><span class="line">public interface AccountService &#123;</span><br><span class="line">    //转账方法</span><br><span class="line">    void transfer(Integer from, Integer to, Double money);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.service;</span><br><span class="line">@Service(&quot;accountService&quot;)</span><br><span class="line">public class AccountServiceImpl implements AccountService &#123;</span><br><span class="line">    @Resource(name=&quot;accountDao&quot;)</span><br><span class="line">    private AccountDao accountDao ;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void transfer(final Integer from,final Integer to,final Double money) &#123;</span><br><span class="line">        //减钱</span><br><span class="line">        accountDao.decreaseMoney(from, money);</span><br><span class="line">        int i = 1/0; //异常</span><br><span class="line">        //加钱</span><br><span class="line">        accountDao.increaseMoney(to, money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>8、创建applicationContext.xml</strong></p>
<p>先不加入事务处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">xmlns=&quot;http://www.springframework.org/schema/beans&quot; </span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot; </span><br><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/context </span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/aop </span><br><span class="line">http://www.springframework.org/schema/aop/spring-aop-4.2.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 注解扫描 --&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;name.yaohuan.spring.dao&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;name.yaohuan.spring.service&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 指定spring读取db.properties配置 --&gt;</span><br><span class="line">&lt;context:property-placeholder location=&quot;classpath:db.properties&quot;  /&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 1、连接池 --&gt;</span><br><span class="line">&lt;bean name=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; &gt;</span><br><span class="line">    &lt;property name=&quot;jdbcUrl&quot; value=&quot;$&#123;jdbc.jdbcUrl&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;driverClass&quot; value=&quot;$&#123;jdbc.driverClass&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;user&quot; value=&quot;$&#123;jdbc.user&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; &gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 2、JdbcTemplate --&gt;</span><br><span class="line">&lt;bean name=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; &gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; &gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p><strong>9、创建测试</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.spring.service;</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="line">public class TxTest &#123;</span><br><span class="line">    @Resource(name=&quot;accountService&quot;)</span><br><span class="line">    private AccountService accountService;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    public void testTransfer()&#123;</span><br><span class="line">        accountService.transfer(1, 2, 100d);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二十、复习事务相关概念"><a href="#二十、复习事务相关概念" class="headerlink" title="二十、复习事务相关概念"></a>二十、复习事务相关概念</h3><p><strong>一、什么是事务(Transaction)</strong></p>
<p>是并发控制的单元，是用户定义的一个操作序列。这些操作要么都做，要么都不做，是一个不可分割的工作单位。通过事务，sql  能将逻辑相关的一组操作绑定在一起，以便服务器 保持数据的完整性。事务通常是以begin transaction开始，以commit或rollback结束。Commint表示提交，即提交事务的所有操作。具体地说就是将事务中所有对数据的更新写回到磁盘上的物理数据库中去，事务正常结束。Rollback表示回滚，即在事务运行的过程中发生了某种故障，事务不能继续进行，系统将事务中对数据库的所有已完成的操作全部撤消，滚回到事务开始的状态。</p>
<p>设想网上购物的一次交易，其付款过程至少包括以下几步数据库操作：</p>
<p>1、更新客户所购商品的库存信息 </p>
<p>2、保存客户付款信息–可能包括与银行系统的交互 </p>
<p>3、生成订单并且保存到数据库中 </p>
<p>4、更新用户相关信息，例如购物数量等等 </p>
<p>正常的情况下，这些操作将顺利进行，最终交易成功，与交易相关的所有数据库信息也成功地更新。但是，如果在这一系列过程中任何一个环节出了差错，例如在更新商品库存信息时发生异常、该顾客银行帐户存款不足等，都将导致交易失败。一旦交易失败，数据库中所有信息都必须保持交易前的状态不变，比如最后一步更新用户信息时失败而导致交易失败，那么必须保证这笔失败的交易不影响数据库的状态–库存信息没有被更新、用户也没有付款，订单也没有生成。否则，数据库的信息将会一片混乱而不可预测。</p>
<p>数据库事务正是用来保证这种情况下交易的平稳性和可预测性的技术</p>
<p><strong>二、为什么要使用事务？</strong> </p>
<p>1、为了提高性能</p>
<p>2、为了保持业务流程的完整性</p>
<p>3、使用分布式事务</p>
<p><strong>三、事务的特性</strong></p>
<p><strong>ACID</strong></p>
<p><strong>1、原子性（atomicity）</strong></p>
<p>事务是数据库的逻辑工作单位，而且是必须是原子工作单位，对于其数据修改，要么全部执行，要么全部不执行。</p>
<p><strong>2、一致性（consistency）</strong></p>
<p>事务在完成时，必须是所有的数据都保持一致状态。在相关数据库中，所有规则都必须应用于事务的修改，以保持所有数据的完整性。</p>
<p><strong>3、隔离性（isolation）</strong></p>
<p>一个事务的执行不能被其他事务所影响。企业级的数据库每一秒钟都可能应付成千上万的并发访问，因而带来了并发控制的问题。由数据库理论可知，由于并发访问，在不可预料的时刻可能引发如下几个可以预料的问题：（见“二、事务的并发问题“）</p>
<p><strong>4、持久性（durability）</strong></p>
<p>一个事务一旦提交，事物的操作便永久性的保存在DB中。即使此时再执行回滚操作也不能撤消所做的更改</p>
<p><strong>四、事务的并发问题</strong></p>
<p><strong>1、脏读（Dirty Read）</strong></p>
<p>一个事务读取到了另一个事务未提交的数据操作结果。这是相当危险的，因为很可能所有的操作都被回滚。</p>
<p><strong>2、不可重复读（虚读）（NonRepeatable Read）</strong></p>
<p>一个事务对同一行数据重复读取两次，但是却得到了不同的结果。例如事务T1读取某一数据后，事务T2对其做了修改，当事务T1再次读该数据时得到与前一次不同的值。</p>
<p><strong>3、幻读（Phantom Read）</strong></p>
<p>事务在操作过程中进行两次查询，第二次查询的结果包含了第一次查询中未出现的数据或者缺少了第一次查询中出现的数据，这是因为在两次查询过程中有另外一个事务插入数据造成的</p>
<p><strong>五、事务的隔离级别</strong></p>
<p><strong>1 - 读未提交</strong></p>
<p>Read uncommitted：最低级别，以上情况均无法保证。</p>
<p><strong>2 - 读已提交</strong></p>
<p>Read committed：可避免脏读情况发生。（Oracle默认）</p>
<p><strong>4 - 可重复读</strong></p>
<p>Repeatable read：可避免脏读、不可重复读情况的发生。不可以避免虚读。（MySQl默认）</p>
<p><strong>8 - 串行化读</strong>Serializable：事务只能一个一个执行，避免了脏读、不可重复读、幻读。执行效率慢，使用时慎重。</p>
<h3 id="二十一、spring的事务管理接口"><a href="#二十一、spring的事务管理接口" class="headerlink" title="二十一、spring的事务管理接口"></a>二十一、spring的事务管理接口</h3><p><strong>1、Spring 的 TransactionManager 接口：</strong></p>
<p>在不同平台，操作事务的代码各不相同，因此spring提供了一个 TransactionManager 接口：</p>
<p>DateSourceTransactionManager 用于 JDBC 的事务管理</p>
<p>HibernateTransactionManager 用于 Hibernate 的事务管理</p>
<p>JpaTransactionManager 用于 Jpa 的事务管理</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/42524505-046b-47e4-bbe3-f4c9984dca6b/index_files/69360651.jpg" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543918091718.png" alt="1543918091718"></p>
<p><strong>2、Spring中 TransactionManager 接口的定义（源码）</strong></p>
<p>事务的属性介绍：这里定义了传播行为、隔离级别、超时时间、是否只读</p>
<p>绝大部分场景下会使用 <em>PROPAGATION_REQUIRED</em> 和 PROPAGATION_SUPPORTS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package org.springframework.transaction;</span><br><span class="line">public interface TransactionDefinition &#123;</span><br><span class="line">    int PROPAGATION_REQUIRED = 0; //支持当前事务，如果不存在，就新建一个</span><br><span class="line">    int PROPAGATION_SUPPORTS = 1; //支持当前事务，如果不存在，就不使用事务</span><br><span class="line">    int PROPAGATION_MANDATORY = 2; //支持当前事务，如果不存在，就抛出异常</span><br><span class="line">    int PROPAGATION_REQUIRES_NEW = 3;//如果有事务存在，挂起当前事务，创建一个新的事物</span><br><span class="line">    int PROPAGATION_NOT_SUPPORTED = 4;//以非事务方式运行，如果有事务存在，挂起当前事务</span><br><span class="line">    int PROPAGATION_NEVER = 5;//以非事务方式运行，如果有事务存在，就抛出异常</span><br><span class="line">    int PROPAGATION_NESTED = 6;//如果有事务存在，则嵌套事务执行</span><br><span class="line">    </span><br><span class="line">    int ISOLATION_DEFAULT = -1;//默认级别，MYSQL: 默认为REPEATABLE_READ级别 SQLSERVER: 默认为READ_COMMITTED</span><br><span class="line">    int ISOLATION_READ_UNCOMMITTED = 1;//读取未提交数据(会出现脏读, 不可重复读) 基本不使用</span><br><span class="line">    int ISOLATION_READ_COMMITTED = 2;//读取已提交数据(会出现不可重复读和幻读)</span><br><span class="line">    int ISOLATION_REPEATABLE_READ = 4;//可重复读(会出现幻读)</span><br><span class="line">    int ISOLATION_SERIALIZABLE = 8;//串行化</span><br><span class="line">    </span><br><span class="line">    int TIMEOUT_DEFAULT = -1;//默认是-1，不超时，单位是秒</span><br><span class="line"></span><br><span class="line">    //事务的传播行为</span><br><span class="line">    int getPropagationBehavior();</span><br><span class="line">    //事务的隔离级别</span><br><span class="line">    int getIsolationLevel();</span><br><span class="line">    //事务超时时间</span><br><span class="line">    int getTimeout();</span><br><span class="line">    //是否只读</span><br><span class="line">    boolean isReadOnly();</span><br><span class="line">    String getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二十二、xml事务管理"><a href="#二十二、xml事务管理" class="headerlink" title="二十二、xml事务管理"></a>二十二、xml事务管理</h3><p><strong>1、在applicationContext.xml中添加 tx 名称空间</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">xmlns=&quot;http://www.springframework.org/schema/beans&quot; </span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot; </span><br><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">http://www.springframework.org/schema/beans/spring-beans-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/context </span><br><span class="line">http://www.springframework.org/schema/context/spring-context-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/aop </span><br><span class="line">http://www.springframework.org/schema/aop/spring-aop-4.2.xsd </span><br><span class="line">http://www.springframework.org/schema/tx </span><br><span class="line">http://www.springframework.org/schema/tx/spring-tx-4.2.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p><strong>2、在applicationContext.xml中添加事务相关配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 事务管理器 --&gt;</span><br><span class="line">&lt;bean id=&quot;transactionManager&quot;</span><br><span class="line">    class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;!-- 数据源 --&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!-- 通知 --&gt;</span><br><span class="line">&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;</span><br><span class="line">    &lt;tx:attributes&gt;</span><br><span class="line">        &lt;!-- 传播行为 --&gt;</span><br><span class="line">        &lt;!-- REQUIRED：如果有事务，则在事务中执行；如果没有事务，则开启一个新的事物 --&gt;</span><br><span class="line">        &lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;add*&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;create*&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;delete*&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;transfer&quot; propagation=&quot;REQUIRED&quot; /&gt;</span><br><span class="line">        &lt;!-- SUPPORTS：如果有事务，则在事务中执行；如果没有事务，则不会开启事物 --&gt;</span><br><span class="line">        &lt;tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;select*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;tx:method name=&quot;get*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/tx:attributes&gt;</span><br><span class="line">&lt;/tx:advice&gt;</span><br><span class="line">&lt;!-- 切面 --&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">    &lt;!-- 定义在service包或者子包里的任意方法的执行 --&gt;</span><br><span class="line">    &lt;aop:pointcut id=&quot;txPointCut&quot;</span><br><span class="line">        expression=&quot;execution(* name.yaohuan.spring.service..*.*(..))&quot; /&gt;</span><br><span class="line">    &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;txPointCut&quot; /&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>
<p><strong>自定义aop和spring事物的执行顺序分析</strong></p>
<p>1、如果先配置spring的事物，后配置自定义的aop，那么事物会在自定义aop通知后提交</p>
<p>2、如果后配置spring的事物，先配置自定义的aop，那么事物会在自定义aop通知前提交</p>
<h3 id="二十三、注解事务管理"><a href="#二十三、注解事务管理" class="headerlink" title="二十三、注解事务管理"></a>二十三、注解事务管理</h3><p><strong>1、修改 applicationContext.xml</strong></p>
<p>在 applicationContext.xml 中添加开启注解事务的配置，删除通知和切面的配置，保留事务管理器的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 事务管理器 --&gt;</span><br><span class="line">&lt;bean id=&quot;transactionManager&quot;</span><br><span class="line">    class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;!-- 数据源 --&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!-- 开启使用注解管理aop事务 --&gt;</span><br><span class="line">&lt;tx:annotation-driven/&gt;</span><br></pre></td></tr></table></figure>
<p><strong>2、在service层的每个方法上添加事务的配置</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">  @Transactional(isolation=Isolation.REPEATABLE_READ,propagation=Propagation.REQUIRED,readOnly=false)</span><br><span class="line">  public void transfer(final Integer from,final Integer to,final Double money) &#123;</span><br></pre></td></tr></table></figure>
<p>也可以在类名上方定义 @Transactional 或配置通用属性，统一定义所有的service方法。如果有方法采用不同的配置，则在方法名上方单独配置 </p>

    </div>
  </article>
  <div class="post-nav">
    <div class="post-nav-next post-nav-item">
      
        <a href="/2018/11/22/hexo + github 搭建个人博客/" rel="next" title="hexo + github 搭建个人博客">
          <i class="fa fa-chevron-left"></i> hexo + github 搭建个人博客
        </a>
      
    </div>

    <span class="post-nav-divider"></span>

    <div class="post-nav-prev post-nav-item">
    
    </div>
  </div>



      </div>
        <div class="footer">
  <div class="footer-wrapper">
    <div class="copyright">
      
      <span>&copy;</span>
      
      <span>2017 - 2018</span>
      
      <span class="author"><i class="fa fa-user"></i>木木夕</span>
    </div>
    
      <span>由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</span>
    
    
      <span>|</span> <span>主题 - <a href="https://github.com/littleee/corazon">Corazon</a></span>
      
        <span>v1.0.0</span>
      
    
  </div>
</div>

    </main>
  </body>
</html>
