<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title>木木夕</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="/lib/jquery.js"></script>
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
  <script src="/js/common.js"></script>
  <script src="/lib/bootstrap/js/bootstrap.js"></script>
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
</head>

  <body>
    <header class="header">
  <div class="color-bar">
    <ul>
      <li class="bar1"></li>
      <li class="bar2"></li>
      <li class="bar3"></li>
      <li class="bar4"></li>
      <li class="bar5"></li>
      <li class="bar6"></li>
    </ul>
  </div>
  <div class="header-wrapper">
    <div class="blog-title">
      
      <a href="/" class="title">木木夕</a>
    </div>
    <nav class="navbar navbar-menu">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" id="nav-btn" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
      </div>
        <ul class="menu menu-pc">
          
            <li class="menu-item">
              <a href="/" class="menu-item-link"><i class="fa fa-home"></i><span>首页</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/tags/" class="menu-item-link"><i class="fa fa-tags"></i><span>标签</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/archives/" class="menu-item-link"><i class="fa fa-file"></i><span>归档</span></a>
            </li>
          
            <li class="menu-item">
              <a href="https://github.com/zymmx/" class="menu-item-link"><i class="fa fa-github"></i><span>github</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/about/" class="menu-item-link"><i class="fa fa-user"></i><span>关于</span></a>
            </li>
          
        </ul>
    </nav>
  </div>
</header>
<div class="collapse nav-collapse" style="position:fixed;top:59px;" id="bs-example-navbar-collapse-1">
  <ul class="menu menu-mobile" style="list-style:none">
    
      <li class="menu-item">
        <a href="/" class="menu-item-link"><i class="fa fa-home"></i><span>首页</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/tags/" class="menu-item-link"><i class="fa fa-tags"></i><span>标签</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/archives/" class="menu-item-link"><i class="fa fa-file"></i><span>归档</span></a>
      </li>
    
      <li class="menu-item">
        <a href="https://github.com/zymmx/" class="menu-item-link"><i class="fa fa-github"></i><span>github</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/about/" class="menu-item-link"><i class="fa fa-user"></i><span>关于</span></a>
      </li>
    
  </ul>
</div>

    <main class="main">
      <div class="content">
        
  <article class="post">
    <div class="post-title">
      <h2 class="title">mybatis详解</h2>
       
        <p>mybatis</p>
      
    </div>
     <div class="post-meta">
      <span class="post-time">2018-12-04</span>
    </div>
    <div class="post-content">
      <p>[TOC]</p>
<h1 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h1><h3 id="01-入门-根据id查询数据"><a href="#01-入门-根据id查询数据" class="headerlink" title="01-入门-根据id查询数据"></a>01-入门-根据id查询数据</h3><p><strong>一、什么是MyBatis（SQL Mapping Framework）</strong></p>
<ul>
<li>MyBatis是对JDBC的封装，</li>
<li>将SQL语句放在了映射文件中，</li>
<li>并且能够自动的将输入参数映射到SQL语句的动态参数上</li>
<li>能够将SQL语句执行的结果集自动的映射成Java对象</li>
</ul>
<p><strong>底层原理：</strong></p>
<p>利用dom4j对xml映射文件进行解析，利用java的反射机制以及动态代理模式生成动态的java类和代理对象，实现对jdbc的封装</p>
<p><strong>MyBatis的核心要素：</strong></p>
<p>1、映射文件（相当于原来的dao类，每个子节点相当于dao中的一个方法）</p>
<p>2、配置文件（配置数据库连接信息、事务和映射文件）</p>
<p><strong>二、MyBatis入门示例</strong></p>
<p><strong>1、java项目：引入jar包</strong></p>
<p>mybatis.jar包</p>
<p>jdbc包</p>
<p>log4j包</p>
<p>junit包</p>
<p><strong>2、maven项目：jar形式，pom.xml</strong> </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!-- 日志 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 单元测试 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- mybatis --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.4.5&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- MySql --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;5.1.45&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、创建数据库表</strong> </p>
<p>执行 blog.sql（先创建库再执行）</p>
<p> <img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/6818ad79-7a28-4495-87fb-0ecf587082d4/index_files/94ccea5a-a2ae-4edc-8836-7e6ae0d93edd.jpg" alt="img">  </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543932919503.png" alt="1543932919503"></p>
<p><strong>4、创建实体类pojo</strong></p>
<p>Blog.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Blog &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String title;</span><br><span class="line">    private Integer authorId;</span><br><span class="line">    private String state;</span><br><span class="line">    private Boolean featured;</span><br><span class="line">    private String style;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5、创建配置文件</strong></p>
<p>5.1、log4j.properties日志文件</p>
<p>5.2、db.properties数据库</p>
<p>5.3、mybatis-config.xml</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">PUBLIC <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;properties resource="db.properties"&gt;&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 定义类型别名 --&gt;</span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;!-- &lt;typeAlias type=<span class="string">"name.yaohuan.mybatis.pojo.Blog"</span> alias=<span class="string">"Blog"</span>/&gt; --&gt;</span><br><span class="line">        &lt;<span class="keyword">package</span> name=<span class="string">"name.yaohuan.mybatis.pojo"</span>/&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 定义数据源 --&gt;</span><br><span class="line">    &lt;environments <span class="keyword">default</span>=<span class="string">"development"</span>&gt;</span><br><span class="line">        &lt;environment id=<span class="string">"development"</span>&gt;</span><br><span class="line">            &lt;transactionManager type="JDBC"&gt;&lt;/transactionManager&gt;</span><br><span class="line">            &lt;dataSource type=<span class="string">"POOLED"</span>&gt;</span><br><span class="line">                &lt;property name=<span class="string">"driver"</span> value=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">"url"</span> value=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">"username"</span> value=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">"password"</span> value=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 定义映射文件 --&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!-- &lt;mapper resource=<span class="string">"name/yaohuan/mybatis/dao/BlogMapper.xml"</span>/&gt; --&gt;</span><br><span class="line">        &lt;<span class="keyword">package</span> name=<span class="string">"name.yaohuan.mybatis.dao"</span> /&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<p><properties>数据库参数配置</properties></p>
<p><typealiases>类型别名：也可以批量定义别名</typealiases></p>
<p><environments>数据库环境配置，包含事务管理和数据库连接池配置</environments></p>
<p><mappers>包含映射文件列表：也可以批量定义映射文件</mappers></p>
<p>注意：此种方法要求mapper接口和mapper映射文件要名称相同，且放到同一个目录下；</p>
<p>5.4、BlogMapper.xml</p>
<p>namespace对应接口的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span><br><span class="line">&lt;mapper namespace=&quot;name.yaohuan.mybatis.dao.BlogMapper&quot; &gt;</span><br><span class="line">   </span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<p>mapper：namespace属性定义完全名，相当于类的全名(包名+类名)</p>
<p>select：id属性定义了一个名为“selectBlog”的映射语句</p>
<p>使用 namespace + id 调用映射语句</p>
<p> 6、在映射文件中编写SQL </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- statment --&gt;</span><br><span class="line">    &lt;select id=&quot;selectBlogById&quot; parameterType=&quot;int&quot; resultType=&quot;Blog&quot;&gt;</span><br><span class="line">        SELECT * FROM blog WHERE id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>7、创建接口类和接口方法 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> name.yaohuan.mybatis.dao;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> name.yaohuan.mybatis.pojo.Blog;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlogMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">Blog <span class="title">selectBlogById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8、写工具类MyBatisUtil.java </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> name.yaohuan.mybatis.utils;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream inputStream = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyBatisUtil</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9、单元测试 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> name.yaohuan.mybatis.dao;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> name.yaohuan.mybatis.pojo.Blog;</span><br><span class="line"><span class="keyword">import</span> name.yaohuan.mybatis.utils.MyBatisUtil;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogMapperTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">        </span><br><span class="line">        BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">        Blog blog = blogDao.selectBlogById(<span class="number">1</span>);</span><br><span class="line">        session.close();</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以不创建Mapper接口 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogNoInterface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">    Blog blog = (Blog) session.selectOne(</span><br><span class="line">    <span class="string">"name.yaohuan.mybatis.dao.BlogMapper.selectBlogById"</span>, <span class="number">1</span>);</span><br><span class="line">    session.close();</span><br><span class="line">    System.out.println(blog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>补充：</strong> </p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/6818ad79-7a28-4495-87fb-0ecf587082d4/index_files/0e03b9a4-9ff1-4530-acb5-b59d4bc15707.png" alt="img"></p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/6818ad79-7a28-4495-87fb-0ecf587082d4/index_files/a798b669-1729-4508-9cc8-ab076b1b50dc.png" alt="img"></p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/6818ad79-7a28-4495-87fb-0ecf587082d4/index_files/d8ee1dfc-fb57-498b-8bdb-32c1002e82dd.png" alt="img"></p>
<p> <img src="C:\Users\Administrator\AppData\Local\Temp\1543933172700.png" alt="1543933172700"></p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543933181281.png" alt="1543933181281"></p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543933189830.png" alt="1543933189830"></p>
<h3 id="02-数据库表的列名和实体类的属性名不一致的情况"><a href="#02-数据库表的列名和实体类的属性名不一致的情况" class="headerlink" title="02-数据库表的列名和实体类的属性名不一致的情况"></a>02-数据库表的列名和实体类的属性名不一致的情况</h3><p><strong>一、方案一</strong></p>
<p><strong>sql语句中定义别名</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用别名处理列名不一致 --&gt;</span><br><span class="line">   &lt;select id=<span class="string">"selectBlogById"</span> parameterType=<span class="string">"int"</span> resultType=<span class="string">"Blog"</span>&gt;</span><br><span class="line">       SELECT </span><br><span class="line">       id,</span><br><span class="line">       title,</span><br><span class="line">       author_id AS authorId,</span><br><span class="line">       state,</span><br><span class="line">       featured,</span><br><span class="line">       style</span><br><span class="line">       FROM blog WHERE id = #&#123;id&#125;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>二、方案二</strong></p>
<p><strong>使用resultMap</strong></p>
<p>在resultMap中至少要定义一个主键列<id>，使用<result>定义其他列，</result></id></p>
<p>cloumn表示表中的列名，property表示实体类中的字段</p>
<p>jdbcType是可选的参数，mybatis可以自动识别，可以省略</p>
<p>mapper：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=&quot;Blog&quot; id=&quot;blogResultMap&quot;&gt;</span><br><span class="line">      &lt;id column=&quot;id&quot; property=&quot;id&quot; /&gt;</span><br><span class="line">      &lt;result column=&quot;author_id&quot; property=&quot;authorId&quot; /&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用resultMap处理列名不一致 --&gt;</span><br><span class="line">   &lt;select id=&quot;selectBlogById2&quot; parameterType=&quot;int&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       SELECT *</span><br><span class="line">       FROM blog WHERE id = #&#123;id&#125;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog selectBlogById2(Integer id);</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogById</span><span class="params">()</span></span>&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       </span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       Blog blog = blogDao.selectBlogById2(<span class="number">1</span>);</span><br><span class="line">       session.close();</span><br><span class="line">       System.out.println(blog);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="03-模糊查询和排序-和"><a href="#03-模糊查询和排序-和" class="headerlink" title="03-模糊查询和排序-# 和 $"></a>03-模糊查询和排序-# 和 $</h3><p>一、模糊查询</p>
<p><strong>需求：</strong>根据博客的名字查询博客列表（模糊查询）</p>
<p><strong>方式一：使用#传参</strong></p>
<p>mapper：</p>
<p><strong>注意：</strong>参数占位符名称任意</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogByTitle&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">      select * from blog where title like #&#123;title&#125;</span><br><span class="line">  &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogByTitle(String title);</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">  public void testSelectBlogByTitle() &#123;</span><br><span class="line">      </span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      </span><br><span class="line">      BlogMapper blogMapper = session.getMapper(BlogMapper.class);</span><br><span class="line">      List&lt;Blog&gt; blogList = blogMapper.selectBlogByTitle(&quot;%o%&quot;);</span><br><span class="line">      </span><br><span class="line">      session.close();</span><br><span class="line">      </span><br><span class="line">      System.out.println(blogList);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>方式二：使用$传参</strong></p>
<p>mapper：</p>
<p><strong>注意：</strong>当时用$传参时，如果参数是单值类型（简单类型），并且只有一个参数，</p>
<p>那么参数必须使用 <strong>value</strong> 占位，并且如果参数是字符串，要使用引号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogByTitle2&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       select * from blog where title like &apos;%$&#123;value&#125;%&apos;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogByTitle2(String title);</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testSelectBlogByTitle2() &#123;</span><br><span class="line">        </span><br><span class="line">        SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">        </span><br><span class="line">        BlogMapper blogMapper = session.getMapper(BlogMapper.class);</span><br><span class="line">        //List&lt;Blog&gt; blogList = blogMapper.selectBlogByTitle2(&quot;%o%&quot;);</span><br><span class="line">        List&lt;Blog&gt; blogList = blogMapper.selectBlogByTitle2(&quot;o&quot;);</span><br><span class="line">        </span><br><span class="line">        session.close();</span><br><span class="line">        </span><br><span class="line">        System.out.println(blogList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>比较#和$的区别：</strong></p>
<ul>
<li>#是占位符？，$是字符串拼接。因此使用$的时候，如果参数是字符串类型，那么要使用引号</li>
<li>尽量使用# 而不是 $</li>
<li>当参数表示表名或列名的时候，只能使用 $</li>
</ul>
<p><strong>不区分大小写的查询：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogByTitle2&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       select * from blog where lower(title) like lower(&apos;%$&#123;value&#125;%&apos;)</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>二、排序</p>
<p><strong>需求：</strong>按照某一列排序</p>
<p>注意：</p>
<p>1、如果使用#，那么sql不会报错，但是排序功能不好使；所以应该使用$</p>
<p>2、中文排序，需要使用mysql的转换函数 CONVERT</p>
<p>mapper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogBySort&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       select * from blog order by CONVERT($&#123;value&#125; USING gbk)</span><br><span class="line">       &lt;!-- select * from blog order by $&#123;value&#125; --&gt;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogBySort(String column);</span><br></pre></td></tr></table></figure>
<p>测试 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testSelectBlogBySort() &#123;</span><br><span class="line">        </span><br><span class="line">        SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">        </span><br><span class="line">        BlogMapper blogMapper = session.getMapper(BlogMapper.class);</span><br><span class="line">        List&lt;Blog&gt; blogList = blogMapper.selectBlogBySort(&quot;title&quot;);</span><br><span class="line">        /*List&lt;Blog&gt; blogList = blogMapper.selectBlogBySort(&quot;CONVERT(title USING gbk)&quot;);*/</span><br><span class="line">        </span><br><span class="line">        session.close();</span><br><span class="line">        </span><br><span class="line">        System.out.println(blogList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="04-分页-多参数传递"><a href="#04-分页-多参数传递" class="headerlink" title="04-分页-多参数传递"></a>04-分页-多参数传递</h3><p><strong>需求：</strong>查询分页数据</p>
<p>一、方法一：使用索引</p>
<p>按照参数的顺序，从0开始</p>
<p>3.2版本：#{0}, #{1}</p>
<p>3.4版本：#{arg0}, #{arg1} 或 #{param1}, #{param2}</p>
<p>mapper：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogByPage&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       select * from blog limit #&#123;0&#125;, #&#123;1&#125;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口：</p>
<p>参数名任意</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogByPage(int offset, int pagesize);</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testSelectBlogByPage() &#123;</span><br><span class="line">        </span><br><span class="line">        SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">        </span><br><span class="line">        BlogMapper blogMapper = session.getMapper(BlogMapper.class);</span><br><span class="line">        List&lt;Blog&gt; blogList = blogMapper.selectBlogByPage(2, 2);</span><br><span class="line">        </span><br><span class="line">        session.close();</span><br><span class="line">        </span><br><span class="line">        System.out.println(blogList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>二、方法二：使用注解</strong></p>
<p>mapper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogByPage2&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       select * from blog limit #&#123;offset&#125;, #&#123;pagesize&#125;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口：注解的value值要和mapper的占位参数一致 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogByPage2(</span><br><span class="line">            @Param(value=&quot;offset&quot;) int offset, </span><br><span class="line">            @Param(value=&quot;pagesize&quot;) int pagesize);</span><br></pre></td></tr></table></figure>
<p><strong>三、方法三：使用map</strong></p>
<p>mapper中的参数占位符要和测试中的map的key 一 一对应</p>
<p>mapper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogByPage3&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">     select * from blog limit #&#123;offset&#125;, #&#123;pagesize&#125;</span><br><span class="line"> &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogByPage3(Map&lt;String, Object&gt; map);</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogByPage3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       </span><br><span class="line">       BlogMapper blogMapper = session.getMapper(BlogMapper.class);</span><br><span class="line">       </span><br><span class="line">       Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">       map.put(<span class="string">"offset"</span>, <span class="number">2</span>);</span><br><span class="line">       map.put(<span class="string">"pagesize"</span>, <span class="number">2</span>);</span><br><span class="line">       List&lt;Blog&gt; blogList = blogMapper.selectBlogByPage3(map);</span><br><span class="line">       </span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(blogList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="05-插入-获取刚刚插入的id（自增id）"><a href="#05-插入-获取刚刚插入的id（自增id）" class="headerlink" title="05-插入-获取刚刚插入的id（自增id）"></a>05-插入-获取刚刚插入的id（自增id）</h3><p><strong>一、插入记录</strong></p>
<p>需求：新增一个博客记录</p>
<p>mapper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insertBlog&quot; parameterType=&quot;Blog&quot;&gt;</span><br><span class="line">       INSERT INTO `blog` (</span><br><span class="line">         `title`,</span><br><span class="line">         `author_id`,</span><br><span class="line">         `state`,</span><br><span class="line">         `featured`,</span><br><span class="line">         `style`</span><br><span class="line">       ) </span><br><span class="line">       VALUES</span><br><span class="line">         (</span><br><span class="line">           #&#123;title&#125;,</span><br><span class="line">           #&#123;authorId&#125;,</span><br><span class="line">           #&#123;state&#125;,</span><br><span class="line">           #&#123;featured&#125;,</span><br><span class="line">           #&#123;style&#125;</span><br><span class="line">         )</span><br><span class="line">   &lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int insertBlog(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertBlog</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">    BlogMapper blogMapper = session.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">    Blog blog = <span class="keyword">new</span> Blog();</span><br><span class="line">    blog.setTitle(<span class="string">"我的blog"</span>);</span><br><span class="line">    blog.setState(<span class="string">"ACTIVE"</span>);</span><br><span class="line">    blog.setStyle(<span class="string">"pink"</span>);</span><br><span class="line">    blog.setFeatured(<span class="keyword">true</span>);</span><br><span class="line">    blog.setAuthorId(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> count = blogMapper.insertBlog(blog);</span><br><span class="line"></span><br><span class="line">    session.commit();</span><br><span class="line">    session.close();</span><br><span class="line"></span><br><span class="line">    System.out.println(blog);<span class="comment">//看看是否有id值（没值）</span></span><br><span class="line">    System.out.println(<span class="string">"插入了"</span> + count + <span class="string">"条记录"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>二、获取自增id</strong></p>
<p><strong>方式一：</strong>在mapper中配置 insert节点的属性 useGeneratedKeys=”true” keyProperty=”id”</p>
<p>mapper</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=<span class="string">"insertBlog"</span> parameterType=<span class="string">"Blog"</span> useGeneratedKeys=<span class="string">"true"</span> keyProperty=<span class="string">"id"</span>&gt;</span><br><span class="line">      INSERT INTO `blog` (</span><br><span class="line">        `title`,</span><br><span class="line">        `author_id`,</span><br><span class="line">        `state`,</span><br><span class="line">        `featured`,</span><br><span class="line">        `style`</span><br><span class="line">      ) </span><br><span class="line">      VALUES</span><br><span class="line">        (</span><br><span class="line">          #&#123;title&#125;,</span><br><span class="line">          #&#123;authorId&#125;,</span><br><span class="line">          #&#123;state&#125;,</span><br><span class="line">          #&#123;featured&#125;,</span><br><span class="line">          #&#123;style&#125;</span><br><span class="line">        )</span><br><span class="line">  &lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<p><strong>方式二：</strong>在全局配置文件中配置 settings选项 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">       &lt;setting name=&quot;useGeneratedKeys&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">   &lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<p>并且在mapper的insert节点配置属性 keyProperty=”id”</p>
<p><strong>方式三：</strong>适用于没有自增主键的数据库（或者mysql中没有使用主键自增策略）</p>
<p>mysql版本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=<span class="string">"insertBlogMysql"</span> parameterType=<span class="string">"Blog"</span>&gt;</span><br><span class="line">     &lt;selectKey resultType=<span class="string">"java.lang.Integer"</span> order=<span class="string">"AFTER"</span> keyProperty=<span class="string">"id"</span>&gt;</span><br><span class="line">         <span class="function">SELECT <span class="title">LAST_INSERT_ID</span><span class="params">()</span></span></span><br><span class="line"><span class="function">     &lt;/selectKey&gt;</span></span><br><span class="line"><span class="function">     INSERT INTO `blog` <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">       `title`,</span></span></span><br><span class="line"><span class="function"><span class="params">       `author_id`,</span></span></span><br><span class="line"><span class="function"><span class="params">       `state`,</span></span></span><br><span class="line"><span class="function"><span class="params">       `featured`,</span></span></span><br><span class="line"><span class="function"><span class="params">       `style`</span></span></span><br><span class="line"><span class="function"><span class="params">     )</span> </span></span><br><span class="line"><span class="function">     VALUES</span></span><br><span class="line"><span class="function">       <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">         #&#123;title&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">         #&#123;authorId&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">         #&#123;state&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">         #&#123;featured&#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">         #&#123;style&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">       )</span>    </span></span><br><span class="line"><span class="function"> &lt;/insert&gt;</span></span><br></pre></td></tr></table></figure>
<p>oracle版本 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=<span class="string">"insertBlogOracle"</span> parameterType=<span class="string">"Blog"</span>&gt;</span><br><span class="line">    &lt;selectKey resultType=<span class="string">"java.lang.Integer"</span> order=<span class="string">"BEFORE"</span> keyProperty=<span class="string">"id"</span>&gt;</span><br><span class="line">        select seq.nextval as id from dual</span><br><span class="line">    &lt;/selectKey&gt;</span><br><span class="line">    INSERT INTO `blog` (</span><br><span class="line">      `title`,</span><br><span class="line">      `author_id`,</span><br><span class="line">      `state`,</span><br><span class="line">      `featured`,</span><br><span class="line">      `style`</span><br><span class="line">    ) </span><br><span class="line">    VALUES</span><br><span class="line">      (</span><br><span class="line">        #&#123;title&#125;,</span><br><span class="line">        #&#123;authorId&#125;,</span><br><span class="line">        #&#123;state&#125;,</span><br><span class="line">        #&#123;featured&#125;,</span><br><span class="line">        #&#123;style&#125;</span><br><span class="line">      )    </span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<h3 id="06-修改"><a href="#06-修改" class="headerlink" title="06-修改"></a>06-修改</h3><p>mapper： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateBlog&quot; parameterType=&quot;Blog&quot;&gt;</span><br><span class="line">       UPDATE </span><br><span class="line">         blog</span><br><span class="line">       SET</span><br><span class="line">         title = #&#123;title&#125;,</span><br><span class="line">         author_id = #&#123;authorId&#125;,</span><br><span class="line">         state = #&#123;state&#125;,</span><br><span class="line">         featured = #&#123;featured&#125;,</span><br><span class="line">         style = #&#123;style&#125; </span><br><span class="line">       WHERE id = #&#123;id&#125; ;</span><br><span class="line">   &lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int updateBlog(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateBlog</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">    Blog blog = <span class="keyword">new</span> Blog();</span><br><span class="line">    blog.setId(<span class="number">27</span>);</span><br><span class="line">    blog.setAuthorId(<span class="number">2</span>);</span><br><span class="line">    blog.setState(<span class="string">"NOT ACTIVE"</span>);</span><br><span class="line">    blog.setFeatured(<span class="keyword">false</span>);</span><br><span class="line">    blog.setStyle(<span class="string">"blue"</span>);</span><br><span class="line">    blog.setTitle(<span class="string">"an's blog"</span>);</span><br><span class="line"></span><br><span class="line">    BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">    <span class="keyword">int</span> count = blogDao.updateBlog(blog);</span><br><span class="line"></span><br><span class="line">    session.commit();</span><br><span class="line">    session.close();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"修改了"</span> + count + <span class="string">"条记录"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>修改时如果不想修改所有字段，那么可以用如下的方式</p>
<p>方法一、先查询记录，再在查询出来的记录上修改</p>
<p>测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateBlog2</span><span class="params">()</span></span>&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//查询</span></span><br><span class="line">       Blog blog = blogDao.selectBlogById(<span class="number">27</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//修改</span></span><br><span class="line">       blog.setId(<span class="number">27</span>);</span><br><span class="line">       blog.setAuthorId(<span class="number">2</span>);</span><br><span class="line">       blog.setTitle(<span class="string">"new blog"</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">int</span> count = blogDao.updateBlog(blog);</span><br><span class="line">       </span><br><span class="line">       session.commit();</span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(<span class="string">"修改了"</span> + count + <span class="string">"条记录"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>方法二、动态SQL</p>
<p>参考后面的动态SQL</p>
<h3 id="07-删除"><a href="#07-删除" class="headerlink" title="07-删除"></a>07-删除</h3><p><strong>一、删除</strong></p>
<p>注意：关联表级联删除的问题会报告如下错误 </p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/8e66c401-11e6-4050-a1bb-06d3f72a845d/index_files/765ca244-a131-4dde-adf2-b35b6f54c8ac.jpg" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543933977271.png" alt="1543933977271"></p>
<p>解决方案1：先删除子记录，再删除父记录</p>
<p>解决方案2：在数据库的外键中设置级联删除</p>
<p>mapper： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;delete id=&quot;deleteBlogById&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">        DELETE FROM blog WHERE id = #&#123;id&#125;</span><br><span class="line">    &lt;/delete&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int deleteBlogById(Integer id);</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"> public void testDeleteBlogById()&#123;</span><br><span class="line">     </span><br><span class="line">     SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">     BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     int count = blogDao.deleteBlogById(27);</span><br><span class="line">     </span><br><span class="line">     session.commit();</span><br><span class="line">     session.close();</span><br><span class="line">     </span><br><span class="line">     System.out.println(&quot;删除了&quot; + count + &quot;条记录&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>二、批量删除</p>
<p>参考后面的动态SQL</p>
<h3 id="08-动态SQL-if"><a href="#08-动态SQL-if" class="headerlink" title="08-动态SQL-if"></a>08-动态SQL-if</h3><p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/d57d9000-02d2-4918-b25f-cca923c086a4/index_files/2b6fe212-c414-494d-8b86-1ffe32d8eb6f.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543934048720.png" alt="1543934048720"></p>
<p><strong>案例一</strong></p>
<p><strong>需求：</strong></p>
<p>1、按博客的名字模糊查询已激活的博客</p>
<p>2、如果用户没有输入任何查询字符串，那么查询所有已激活的blog</p>
<p><strong>分析：</strong></p>
<p>– 用户输入了查询字符串</p>
<p>SELECT * FROM blog </p>
<p>WHERE state = ‘ACTIVE’ </p>
<p>AND title LIKE ‘%a%’</p>
<p>– 用户没有输入查询字符串</p>
<p>SELECT * FROM blog </p>
<p>WHERE state = ‘ACTIVE’</p>
<p>注意：</p>
<p>1、参数类型如果是多值对象，如Blog类型，那么if语句中的test属性判断使用Blog的属性名</p>
<p>2、参数类型如果是简单类型，如String类型，那么if语句中的test属性判断使用value关键字</p>
<p>如果使用简单类型（string），那么test中无法判断 空字符串””（不要写value != ‘’ 判断不出来，有坑）</p>
<p>如果使用$ 那么 传值应该使用 ${value}， if中判断也应该使用 value 关键字</p>
<p>如果使用# 那么 传值应该使用 #{任意名}， if中判断还是使用 value 关键字</p>
<p><strong>因此：最好使用对象传参</strong></p>
<p><strong>传递单值参数</strong></p>
<p>mapper： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectActiveBlogByTitle&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">     SELECT * FROM blog </span><br><span class="line">     WHERE state = &apos;ACTIVE&apos; </span><br><span class="line">     &lt;if test=&quot;value != null and value != &apos;&apos;&quot;&gt;</span><br><span class="line">         AND title LIKE &apos;%$&#123;value&#125;%&apos;</span><br><span class="line">     &lt;/if&gt;</span><br><span class="line"> &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectActiveBlogByTitle(String title);</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testSelectActiveBlogByTitle()&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       </span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       //List&lt;Blog&gt; blogList = blogDao.selectActiveBlogByTitle(&quot;o&quot;);</span><br><span class="line">       //List&lt;Blog&gt; blogList = blogDao.selectActiveBlogByTitle(&quot;&quot;);</span><br><span class="line">       List&lt;Blog&gt; blogList = blogDao.selectActiveBlogByTitle(null);</span><br><span class="line">       </span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(blogList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>案例二</p>
<p><strong>需求：</strong></p>
<p>1、查询已激活的，并且根据blog的名字和是否推荐来查询</p>
<p>2、如果用户没有输入任何查询条件，那么查询所有已激活的blog</p>
<p><strong>分析：</strong></p>
<p>– 用户输入了查询条件</p>
<p>SELECT * FROM blog </p>
<p>WHERE state = ‘ACTIVE’ </p>
<p>AND title LIKE ‘%a%’</p>
<p>AND featured = TRUE</p>
<p>– 用户没有输入查询条件</p>
<p>SELECT * FROM blog </p>
<p>WHERE state = ‘ACTIVE’</p>
<p><strong>注意：</strong>要修改pojo中Blog的featured的数据类型是Boolean</p>
<p><strong>方案：</strong>传递多值对象参数</p>
<p>mapper：</p>
<p>映射文件中可以使用参数Blog中的属性的名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectActiveBlogByTitleAndFeatured&quot; parameterType=&quot;Blog&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">    SELECT * FROM blog </span><br><span class="line">    WHERE state = &apos;ACTIVE&apos; </span><br><span class="line">    &lt;if test=&quot;title != null and title != &apos;&apos;&quot;&gt;</span><br><span class="line">        AND title LIKE &apos;%$&#123;title&#125;%&apos;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;featured != null&quot;&gt;</span><br><span class="line">        AND featured = #&#123;featured&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectActiveBlogByTitleAndFeatured(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testSelectActiveBlogByTitleAndFeatured()&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       </span><br><span class="line">       Blog blog = new Blog();</span><br><span class="line">       blog.setTitle(&quot;树&quot;);</span><br><span class="line">       blog.setFeatured(true);</span><br><span class="line">       </span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       List&lt;Blog&gt; blogList = blogDao.selectActiveBlogByTitleAndFeatured(blog);</span><br><span class="line">       </span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(blogList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>补充：</strong>忽略大小写的查询，使用LOWER或UPPER </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AND LOWER(title) LIKE LOWER(&apos;%$&#123;title&#125;%&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="09-动态SQL-choose、when、otherwise"><a href="#09-动态SQL-choose、when、otherwise" class="headerlink" title="09-动态SQL-choose、when、otherwise"></a>09-动态SQL-choose、when、otherwise</h3><p>choose：在when和otherwise中选择</p>
<p>when：必须的，一个或多个</p>
<p>otherwise：可选的，一个或零个</p>
<p><strong>需求：</strong></p>
<p>1、查询已激活的</p>
<p>2、如果用户输入了blog的查询关键字，</p>
<p>3、则根据关键字查询，否则根据blog的风格样式查询，</p>
<p>4、否则给用户显示推荐的blog</p>
<p><strong>分析：</strong></p>
<p>2、3、4条件互斥</p>
<p><strong>方案：</strong></p>
<p>mapper：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">"selectActiveBlogByTitleOrStyle"</span> parameterType=<span class="string">"Blog"</span> resultMap=<span class="string">"blogResultMap"</span>&gt;</span><br><span class="line">       SELECT * FROM blog </span><br><span class="line">       WHERE state = <span class="string">'ACTIVE'</span> </span><br><span class="line">       &lt;choose&gt;</span><br><span class="line">           &lt;when test=<span class="string">"title != null and title != ''"</span>&gt;</span><br><span class="line">               <span class="function">AND <span class="title">LOWER</span><span class="params">(title)</span> LIKE <span class="title">LOWER</span><span class="params">(<span class="string">'%$&#123;title&#125;%'</span>)</span></span></span><br><span class="line"><span class="function">           &lt;/when&gt;</span></span><br><span class="line"><span class="function">           &lt;when test</span>=<span class="string">"style != null"</span>&gt;</span><br><span class="line">               AND style = #&#123;style&#125;</span><br><span class="line">           &lt;/when&gt;</span><br><span class="line">           &lt;otherwise&gt;</span><br><span class="line">               AND featured = <span class="keyword">true</span></span><br><span class="line">           &lt;/otherwise&gt;</span><br><span class="line">       &lt;/choose&gt;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectActiveBlogByTitleOrStyle(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectActiveBlogByTitleOrStyle</span><span class="params">()</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      </span><br><span class="line">      Blog blog = <span class="keyword">new</span> Blog();</span><br><span class="line">      <span class="comment">//blog.setTitle("O");</span></span><br><span class="line">      <span class="comment">//blog.setStyle("red");</span></span><br><span class="line">      </span><br><span class="line">      BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">      List&lt;Blog&gt; blogList = blogDao.selectActiveBlogByTitleOrStyle(blog);</span><br><span class="line">      </span><br><span class="line">      session.close();</span><br><span class="line">      </span><br><span class="line">      System.out.println(blogList);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-动态SQL-where"><a href="#10-动态SQL-where" class="headerlink" title="10-动态SQL-where"></a>10-动态SQL-where</h3><p><strong>需求：</strong></p>
<p>多条件查询：状态、标题、是否推荐</p>
<p><where>会自动去掉查询条件中多余的第一个逻辑符号，如 and、or</where></p>
<p>mapper：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">"selectBlog"</span> parameterType=<span class="string">"Blog"</span> resultMap=<span class="string">"blogResultMap"</span>&gt;</span><br><span class="line">       SELECT * FROM blog</span><br><span class="line">       &lt;where&gt;</span><br><span class="line">           &lt;<span class="keyword">if</span> test=<span class="string">"state != null and state != ''"</span>&gt;</span><br><span class="line">               state = #&#123;state&#125;</span><br><span class="line">           &lt;/if&gt;</span><br><span class="line">           &lt;<span class="keyword">if</span> test=<span class="string">"title != null and title != ''"</span>&gt;</span><br><span class="line">               <span class="function">AND <span class="title">LOWER</span><span class="params">(title)</span> LIKE <span class="title">LOWER</span><span class="params">(<span class="string">'%$&#123;title&#125;%'</span>)</span></span></span><br><span class="line"><span class="function">           &lt;/<span class="keyword">if</span>&gt;</span></span><br><span class="line"><span class="function">           &lt;<span class="keyword">if</span> test</span>=<span class="string">"featured != null"</span>&gt;</span><br><span class="line">               AND featured = #&#123;featured&#125;</span><br><span class="line">           &lt;/if&gt;</span><br><span class="line">       &lt;/where&gt;</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlog(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">  public void testSelectBlog()&#123;</span><br><span class="line">      </span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      </span><br><span class="line">      Blog blog = new Blog();</span><br><span class="line">      blog.setState(&quot;ACTIVE&quot;);</span><br><span class="line">      blog.setTitle(&quot;O&quot;);</span><br><span class="line">      blog.setFeatured(false);</span><br><span class="line">      </span><br><span class="line">      BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">      List&lt;Blog&gt; blogList = blogDao.selectBlog(blog);</span><br><span class="line">      </span><br><span class="line">      session.close();</span><br><span class="line">      </span><br><span class="line">      System.out.println(blogList);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-动态SQL-set"><a href="#11-动态SQL-set" class="headerlink" title="11-动态SQL-set"></a>11-动态SQL-set</h3><p><strong>需求：</strong></p>
<p>按需修改：修改指定的列，未指定的不修改</p>
<p><set>会自动去掉update语句的set子句中多余的最后一个逗号</set></p>
<p>mapper：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">"updateBlogIfNecessary"</span> parameterType=<span class="string">"Blog"</span>&gt;</span><br><span class="line">      UPDATE blog</span><br><span class="line">      &lt;set&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"title != null and title != ''"</span>&gt;</span><br><span class="line">              title = #&#123;title&#125;,</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"authorId != null"</span>&gt;</span><br><span class="line">              author_id = #&#123;authorId&#125;,</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"state != null and state != ''"</span>&gt;</span><br><span class="line">              state = #&#123;state&#125;,</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"featured != null"</span>&gt;</span><br><span class="line">              featured = #&#123;featured&#125;,</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"style != null and style != ''"</span>&gt;</span><br><span class="line">              state = #&#123;state&#125;</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">      &lt;/set&gt;</span><br><span class="line">      WHERE id = #&#123;id&#125;</span><br><span class="line">  &lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p>接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int updateBlogIfNecessary(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateBlogIfNecessary</span><span class="params">()</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">      </span><br><span class="line">      Blog blog = <span class="keyword">new</span> Blog();</span><br><span class="line">      blog.setId(<span class="number">3</span>);</span><br><span class="line">      blog.setTitle(<span class="string">"new title"</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">int</span> count = blogDao.updateBlogIfNecessary(blog);</span><br><span class="line">      </span><br><span class="line">      session.commit();</span><br><span class="line">      session.close();</span><br><span class="line">      </span><br><span class="line">      System.out.println(<span class="string">"修改了"</span> + count + <span class="string">"条记录"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-动态SQL-trim"><a href="#12-动态SQL-trim" class="headerlink" title="12-动态SQL-trim"></a>12-动态SQL-trim</h3><p>trim可以实现set和where的功能</p>
<p>一、trim实现where的功能</p>
<p>mapper：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">"selectBlogTrim"</span> parameterType=<span class="string">"Blog"</span> resultMap=<span class="string">"blogResultMap"</span>&gt;</span><br><span class="line">       SELECT * FROM blog</span><br><span class="line">       &lt;trim prefix=<span class="string">"WHERE"</span> prefixOverrides=<span class="string">"AND | OR"</span>&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"state != null and state != ''"</span>&gt;</span><br><span class="line">              state = #&#123;state&#125;</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">"title != null and title != ''"</span>&gt;</span><br><span class="line">              <span class="function">AND <span class="title">LOWER</span><span class="params">(title)</span> LIKE <span class="title">LOWER</span><span class="params">(<span class="string">'%$&#123;title&#125;%'</span>)</span></span></span><br><span class="line"><span class="function">          &lt;/<span class="keyword">if</span>&gt;</span></span><br><span class="line"><span class="function">          &lt;<span class="keyword">if</span> test</span>=<span class="string">"featured != null"</span>&gt;</span><br><span class="line">              AND featured = #&#123;featured&#125;</span><br><span class="line">          &lt;/if&gt;</span><br><span class="line">      &lt;/trim&gt;</span><br><span class="line">  &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogTrim(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogTrim</span><span class="params">()</span></span>&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       </span><br><span class="line">       Blog blog = <span class="keyword">new</span> Blog();</span><br><span class="line">       blog.setState(<span class="string">"ACTIVE"</span>);</span><br><span class="line">       blog.setTitle(<span class="string">"O"</span>);</span><br><span class="line">       blog.setFeatured(<span class="keyword">false</span>);</span><br><span class="line">       </span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       List&lt;Blog&gt; blogList = blogDao.selectBlogTrim(blog);</span><br><span class="line">       </span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(blogList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>二、trim实现set的功能</p>
<p>mapper：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">"updateBlogIfNecessaryTrim"</span> parameterType=<span class="string">"Blog"</span>&gt;</span><br><span class="line">        UPDATE blog</span><br><span class="line">        &lt;trim prefix=<span class="string">"SET"</span> suffixOverrides=<span class="string">","</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">"title != null and title != ''"</span>&gt;</span><br><span class="line">                title = #&#123;title&#125;,</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">"authorId != null"</span>&gt;</span><br><span class="line">                author_id = #&#123;authorId&#125;,</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">"state != null and state != ''"</span>&gt;</span><br><span class="line">                state = #&#123;state&#125;,</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">"featured != null"</span>&gt;</span><br><span class="line">                featured = #&#123;featured&#125;,</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">"style != null and style != ''"</span>&gt;</span><br><span class="line">                state = #&#123;state&#125;</span><br><span class="line">            &lt;/if&gt;</span><br><span class="line">        &lt;/trim&gt;</span><br><span class="line">        WHERE id = #&#123;id&#125;</span><br><span class="line">      &lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p>接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int updateBlogIfNecessaryTrim(Blog blog);</span><br></pre></td></tr></table></figure>
<p>测试用例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdateBlogIfNecessaryTrim()&#123;</span><br><span class="line">    </span><br><span class="line">    SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">    BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">    </span><br><span class="line">    Blog blog = new Blog();</span><br><span class="line">    blog.setId(3);</span><br><span class="line">    blog.setTitle(&quot;new title&quot;);</span><br><span class="line">    </span><br><span class="line">    int count = blogDao.updateBlogIfNecessaryTrim(blog);</span><br><span class="line">    </span><br><span class="line">    session.commit();</span><br><span class="line">    session.close();</span><br><span class="line">    </span><br><span class="line">    System.out.println(&quot;修改了&quot; + count + &quot;条记录&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-动态SQL-foreach"><a href="#13-动态SQL-foreach" class="headerlink" title="13-动态SQL-foreach"></a>13-动态SQL-foreach</h3><p>需求：实现批量删除</p>
<p>向sql传递数组或List时，mybatis使用foreach解析数组里的参数并拼接到SQL中。</p>
<p>mapper：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;delete id=&quot;deleteBlogList&quot; parameterType=&quot;list&quot;&gt;</span><br><span class="line">     DELETE FROM blog WHERE id IN</span><br><span class="line">     &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">         #&#123;item&#125;</span><br><span class="line">     &lt;/foreach&gt;</span><br><span class="line"> &lt;/delete&gt;</span><br></pre></td></tr></table></figure>
<p>接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int deleteBlogList(List&lt;Integer&gt; idList);</span><br></pre></td></tr></table></figure>
<p>测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 批量删除</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteBlogList</span><span class="params">()</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">      </span><br><span class="line">      List&lt;Integer&gt; idList = Arrays.asList(<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>);</span><br><span class="line">      <span class="keyword">int</span> count = blogDao.deleteBlogList(idList);</span><br><span class="line">      </span><br><span class="line">      session.commit();</span><br><span class="line">      session.close();</span><br><span class="line">      </span><br><span class="line">      System.out.println(<span class="string">"删除了"</span> + count + <span class="string">"条记录"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/5510f16b-e4a8-402d-9634-75d865e90afe/index_files/143037078.jpg" alt="img"></p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543934524583.png" alt="1543934524583"></p>
<h3 id="14-动态SQL-SQL片段"><a href="#14-动态SQL-SQL片段" class="headerlink" title="14-动态SQL-SQL片段"></a>14-动态SQL-SQL片段</h3><p>Mybatis提供了SQL片段的功能，可以提高SQL的可重用性</p>
<p>定义片段：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 定义列名片段 --&gt;</span><br><span class="line">&lt;sql id=<span class="string">"columnBase"</span>&gt;</span><br><span class="line">    id,</span><br><span class="line">    title,</span><br><span class="line">    author_id AS authorId,</span><br><span class="line">    state,</span><br><span class="line">    featured,</span><br><span class="line">    style</span><br><span class="line">&lt;/sql&gt;</span><br></pre></td></tr></table></figure>
<p>使用片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogById&quot; parameterType=&quot;int&quot; resultType=&quot;Blog&quot;&gt;</span><br><span class="line">     SELECT</span><br><span class="line">     &lt;include refid=&quot;columnBase&quot;&gt;&lt;/include&gt;</span><br><span class="line">     FROM blog WHERE id = #&#123;id&#125;</span><br><span class="line"> &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h3 id="15-性能-一级缓存"><a href="#15-性能-一级缓存" class="headerlink" title="15-性能-一级缓存"></a>15-性能-一级缓存</h3><p>一级缓存就是session级别的缓存，一级缓存默认存在 </p>
<p>一、测试一：</p>
<p><strong>下面的测试说明</strong>：两次查询，第一次查询结果从数据库查询，缓存到sqlsession缓存区域，第二次查询直接返回，不查询数据库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一级缓存测试1</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCacheLevelOne1</span><span class="params">()</span></span>&#123;</span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//第一次查询执行sql语句</span></span><br><span class="line">      Blog blog1 = blogDao.selectBlogById(<span class="number">1</span>);</span><br><span class="line">      System.out.println(<span class="string">"查询结果"</span>);</span><br><span class="line">      <span class="comment">//第二次查询不执行sql语句，直接从缓存中读取数据</span></span><br><span class="line">      Blog blog2 = blogDao.selectBlogById(<span class="number">1</span>);</span><br><span class="line">      System.out.println(<span class="string">"查询结果"</span>);</span><br><span class="line">      session.close();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>二、测试二：</p>
<p>在第一个测试用例的基础上增加中间黄色的部分</p>
<p><strong>下面的测试说明：</strong>如果两次查询之间，有增加、删除、修改操作并其提交，sqlsession缓存区域会自动清空。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 一级缓存测试2</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCacheLevelOne2</span><span class="params">()</span></span>&#123;</span><br><span class="line">     SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">     BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//第一次查询执行sql语句</span></span><br><span class="line">     Blog blog1 = blogDao.selectBlogById(<span class="number">1</span>);</span><br><span class="line">     System.out.println(<span class="string">"查询结果"</span>);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//如果有insert、update和delete，则会清空缓存空间</span></span><br><span class="line">     blog1.setFeatured(<span class="keyword">true</span>);</span><br><span class="line">     blogDao.updateBlog(blog1);</span><br><span class="line">     System.out.println(<span class="string">"更新"</span>);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//第二次查询重新执行sql语句</span></span><br><span class="line">     Blog blog2 = blogDao.selectBlogById(<span class="number">1</span>);</span><br><span class="line">     System.out.println(<span class="string">"查询结果"</span>);</span><br><span class="line">     session.commit();</span><br><span class="line">     session.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="16-性能-二级缓存"><a href="#16-性能-二级缓存" class="headerlink" title="16-性能-二级缓存"></a>16-性能-二级缓存</h3><p><strong>一、测试：</strong></p>
<p><strong>跨</strong>seesion范围，默认情况下，不配置二级缓存，会执行两次数据库的sql查询</p>
<p>注意：这个例子中创建了两个session对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二级缓存测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCacheLevelTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//第一次查询执行sql语句</span></span><br><span class="line">    SqlSession session1 = MyBatisUtil.getSqlSession();</span><br><span class="line">    BlogMapper blogDao1 = session1.getMapper(BlogMapper.class);</span><br><span class="line">    Blog blog1 = blogDao1.selectBlogById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">"查询结果"</span>); </span><br><span class="line">    session1.close();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//不开启二级缓存时：第二次查询 执行sql语句</span></span><br><span class="line">    SqlSession session2 = MyBatisUtil.getSqlSession();</span><br><span class="line">    BlogMapper blogDao2 = session2.getMapper(BlogMapper.class);  </span><br><span class="line">    Blog blog2 = blogDao2.selectBlogById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">"查询结果"</span>);</span><br><span class="line">    session2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>二、启用二级缓存：</strong></p>
<p>1、在对应的表的mapper映射文件中添加一行 <cache>  </cache></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;name.yaohuan.mybatis.dao.BlogMapper&quot;&gt;</span><br><span class="line">    &lt;!-- 开启二级缓存 --&gt;</span><br><span class="line">    &lt;cache /&gt;</span><br></pre></td></tr></table></figure>
<p>2、对应的实体类必须是可以序列化的 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public class Blog implements Serializable&#123;</span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br></pre></td></tr></table></figure>
<p><strong>重新执行上面的测试用例</strong></p>
<p>一旦看到Cache Hit Ratio 命中率，说明二级缓存开启成功，查到次数/查询次数=0.0</p>
<p>第二次查询，直接从缓存读取数据，命中率： 1/2=0.5</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/c88cb900-0577-4bed-bbb7-3d6acd9d568b/index_files/b914175c-63ed-4b88-b448-76d07086af13.png" alt="img"></p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543934749739.png" alt="1543934749739"></p>
<p><strong>这个简单语句的效果如下：</strong></p>
<p>映射语句文件中的所有select语句将会被缓存。</p>
<p>和一级缓存一样，所有insert，update和delete语句会刷新缓存。</p>
<p>例如：在第一次session关闭前加入update语句会清空缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">blog1.setFeatured(true);</span><br><span class="line">     blogDao1.updateBlog(blog1);</span><br><span class="line">     System.out.println(&quot;更新&quot;);</span><br><span class="line">     session1.commit();</span><br></pre></td></tr></table></figure>
<p>对于映射文件的select：</p>
<p>useCache属性</p>
<p>将其设置为true，将会导致本条语句的结果被缓存。默认值：true。</p>
<p>如果设置成false，可以阻止二级缓存的产生，但不能阻止一级缓存的产生。</p>
<p>对于映射文件的select、insert、update、delete：</p>
<p>flushCache属性</p>
<p>将其设置为true，无论语句什么时候被调用，都会导致缓存被清空。</p>
<p>可以清空一级缓存和二级缓存</p>
<p><strong>其他：</strong></p>
<p><strong>配置<cache>属性：</cache></strong></p>
<p>所有的这些属性都可以通过缓存元素的属性来修改。比如：</p>
<cache eviction="FIFO" flushinterval="60000" size="512" readonly="true">

<p>这个更高级的配置创建了一个FIFO缓存，并每隔60秒刷新，存数结果对象或列表的512个引用，而且返回的对象被认为是只读的，因此在不同线程中的调用者之间修改它们会导致冲突。</p>
<p>可用的收回策略有：</p>
<p>. LRU – 最近最少使用的：移除最长时间不被使用的对象。</p>
<p>. FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</p>
<p>. SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</p>
<p>. WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</p>
<p>默认的是LRU。</p>
<p>flushInterval（刷新间隔）可以被设置为任意的正整数，而且它们代表一个合理的毫秒形式的时间段。默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句时刷新。</p>
<p>size（引用数目）可以被设置为任意正整数，要记住你缓存的对象数目和你运行环境的可用内存资源数目。默认值是1024。</p>
<p>readOnly（只读）属性可以被设置为true或false。只读的缓存会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。可读写的缓存会返回缓存对象的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是false。</p>
<p><strong>全局配置：</strong></p>
<p>注意：cacheEnabled 默认就是开启的，设置为false则全局范围内关闭二级缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 全局设置 --&gt;</span><br><span class="line">  &lt;settings&gt;</span><br><span class="line">      &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">      ......</span><br><span class="line">  &lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<p><strong>三、应用场景：</strong></p>
<p>对于访问响应速度要求高，但是实时性不高的查询，可以采用二级缓存技术。</p>
<p>注意：在使用二级缓存的时候，要设置一下刷新间隔（cache标签中有一个flashInterval属性）来定时刷新二级缓存，这个刷新间隔根据具体需求来设置，比如设置30分钟、60分钟等，单位为毫秒</p>
<p><strong>四、局限性：</strong></p>
<p>Mybatis二级缓存对细粒度的数据，缓存实现不好。</p>
<p>场景：对商品信息进行缓存，由于商品信息查询访问量大，但是要求用户每次查询都是最新的商品信息，此时如果使用二级缓存，就无法实现当一个商品发生变化只刷新该商品的缓存信息而不刷新其他商品缓存信息，因为二级缓存是mapper级别的，当一个商品的信息发送更新，所有的商品信息缓存数据都会清空。</p>
<p>解决此类问题，需要在业务层根据需要对数据有针对性的缓存。</p>
<p>比如可以对经常变化的 数据操作单独放到另一个namespace的mapper中。</p>
<h3 id="17-性能-整合ehcache"><a href="#17-性能-整合ehcache" class="headerlink" title="17-性能-整合ehcache"></a>17-性能-整合ehcache</h3><p> 一、什么是ehcache</p>
<p>Mybatis本身是一个持久层框架，它不是专门的缓存框架，所以它对缓存的实现不够好，不能支持分布式。</p>
<p>Ehcache是一个分布式的缓存框架。</p>
<p> <img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/709d1e27-27fc-485f-93f4-e3658ea6ecb2/index_files/e1954a34-f261-4505-8208-c75c991f237a.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543934834811.png" alt="1543934834811"></p>
<p><strong>二、整合思路</strong></p>
<p>Cache是一个接口，它的默认实现是mybatis的PerpetualCache。如果想整合mybatis的二级缓存，那么实现Cache接口即可。</p>
<p><strong>三、整合步骤</strong></p>
<p><strong>1、添加jar包：</strong></p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/709d1e27-27fc-485f-93f4-e3658ea6ecb2/index_files/f72bc8d4-611c-4118-8e1a-f0743a09d1f3.png" alt="img"></p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543934851485.png" alt="1543934851485"></p>
<p><strong>2、设置映射文件中cache标签的type值为ehcache的实现类：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 第三方二级缓存框架 --&gt;</span><br><span class="line">  &lt;!-- type: 二级缓存的实现类，默认实现类是 org.apache.ibatis.cache.implPerpetualCache--&gt;</span><br><span class="line">  &lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、添加ehcache的配置文件：</strong></p>
<p>在配置文件目录下创建ehcache.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- 缓存数据要存放的磁盘地址 --&gt;</span><br><span class="line">&lt;diskStore path=&quot;D:\ehcache&quot; /&gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">diskStore：指定数据在磁盘中的存储位置。 </span><br><span class="line">defaultCache：当借助CacheManager.add(&quot;demoCache&quot;)创建Cache时，EhCache便会采用&lt;defalutCache/&gt;指定的的管理策略 </span><br><span class="line">以下属性是必须的： </span><br><span class="line">    maxElementsInMemory - 在内存中缓存的element的最大数目 </span><br><span class="line">    maxElementsOnDisk - 在磁盘上缓存的element的最大数目，若是0表示无穷大 </span><br><span class="line">    eternal - 设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断 </span><br><span class="line">           overflowToDisk - 设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上 </span><br><span class="line">以下属性是可选的： </span><br><span class="line">    timeToIdleSeconds - 当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时，这些数据便会删除，</span><br><span class="line">    默认值是0,也就是可闲置时间无穷大 </span><br><span class="line">    timeToLiveSeconds - 缓存element的有效生命期，默认是0.,也就是element存活时间无穷大 </span><br><span class="line">    diskSpoolBufferSizeMB - 这个参数设置DiskStore(磁盘缓存)的缓存区大小.默认是30MB.每个Cache都应该有自己的一个缓冲区. </span><br><span class="line">    diskPersistent - 在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false。 </span><br><span class="line">    diskExpiryThreadIntervalSeconds - 磁盘缓存的清理线程运行间隔，默认是120秒。每个120s，相应的线程会进行一次EhCache中数据的清理工作 </span><br><span class="line">    memoryStoreEvictionPolicy - 当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。</span><br><span class="line">    默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出） </span><br><span class="line">--&gt;</span><br><span class="line">&lt;defaultCache </span><br><span class="line">maxElementsInMemory=&quot;1000&quot;</span><br><span class="line">maxElementsOnDisk=&quot;10000000&quot; </span><br><span class="line">eternal=&quot;false&quot; </span><br><span class="line">overflowToDisk=&quot;false&quot;</span><br><span class="line">timeToIdleSeconds=&quot;120&quot; </span><br><span class="line">timeToLiveSeconds=&quot;120&quot;</span><br><span class="line">diskExpiryThreadIntervalSeconds=&quot;120&quot; </span><br><span class="line">memoryStoreEvictionPolicy=&quot;LRU&quot;&gt;</span><br><span class="line">&lt;/defaultCache&gt;</span><br></pre></td></tr></table></figure>
<p><strong>4、测试：</strong></p>
<p>参考上一节的测试方式</p>
<h3 id="18-高级结果映射-嵌套查询-关联映射"><a href="#18-高级结果映射-嵌套查询-关联映射" class="headerlink" title="18-高级结果映射-嵌套查询-关联映射"></a>18-高级结果映射-嵌套查询-关联映射</h3><p>项目：mybatis<strong>02relation</strong></p>
<p><strong>把pojo拷贝过来，重新创建映射文件</strong></p>
<p><strong>需求：</strong>查询博客信息，同时查询作者信息：Blog和Author是一对一的关系</p>
<p>注意：如果有相互引用，则打印输出的时候会出现栈内存溢出的异常，可以将一方的关联配置配置到返回值是 resultType 的 statement 中</p>
<p>关联映射（适用于一对一和多对一）</p>
<p>pojo：在Blog类中设计author属性，用来替换authorId</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public class Blog &#123;</span><br><span class="line">    /*private Integer authorId;*/</span><br><span class="line">    private Author author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pojo：Author </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.mybatis.pojo;</span><br><span class="line">public class Author &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private String email;</span><br><span class="line">    private String bio;</span><br><span class="line">    private String favouriteSection;</span><br><span class="line">    private String nickname;</span><br><span class="line">    private String realname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>blog的mapper：</p>
<p><strong>说明：</strong></p>
<p>1、property对应实体类中的属性</p>
<p>2、column对应数据库中的外键字段</p>
<p>3、javaType表示实体类中属性的类型，在这里不是必须的属性</p>
<p>4、select表示通过column字段进一步查询需要的sql语句，column的值作为参数传递给这个sql语句</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=<span class="string">"Blog"</span> id=<span class="string">"blogResultMap"</span>&gt;</span><br><span class="line">      &lt;id column=<span class="string">"id"</span> property=<span class="string">"id"</span> jdbcType=<span class="string">"INTEGER"</span> /&gt;</span><br><span class="line">      &lt;association property=<span class="string">"author"</span> column=<span class="string">"author_id"</span> javaType=<span class="string">"Author"</span></span><br><span class="line">      select="name.yaohuan.mybatis.dao.AuthorMapper.selectAuthorById"&gt;&lt;/association&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">  &lt;select id=<span class="string">"selectBlogById"</span> parameterType=<span class="string">"int"</span> resultMap=<span class="string">"blogResultMap"</span>&gt;</span><br><span class="line">      SELECT * FROM blog WHERE id = #&#123;id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>author的mapper： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">"name.yaohuan.mybatis.dao.AuthorMapper"</span> &gt;</span><br><span class="line">    &lt;resultMap type=<span class="string">"Author"</span> id=<span class="string">"authorResultMap"</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">"id"</span> property=<span class="string">"id"</span> jdbcType=<span class="string">"INTEGER"</span> /&gt;</span><br><span class="line">        &lt;result column=<span class="string">"favourite_section"</span> property=<span class="string">"favouriteSection"</span> jdbcType=<span class="string">"VARCHAR"</span> /&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;select id=<span class="string">"selectAuthorById"</span> parameterType=<span class="string">"int"</span> resultMap=<span class="string">"authorResultMap"</span>&gt;</span><br><span class="line">        SELECT * FROM author WHERE id = #&#123;id&#125; </span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<p>blog的接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog selectBlogById(Integer id);</span><br></pre></td></tr></table></figure>
<p>author的接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Author selectAuthorById(Integer id);</span><br></pre></td></tr></table></figure>
<p><strong>测试用例 1：</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogMapperTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">        </span><br><span class="line">        BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">        Blog blog = blogDao.selectBlogById(<span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        session.close();</span><br><span class="line">        </span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试用例2：</strong> </p>
<p>查询Blog<strong>列表</strong>时，执行的sql语句是 1 + n ， 但是如果blog关联的author有重复的数据，那么回从一级缓存中查询。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogList&quot; resultMap=&quot;blogResultMap&quot;&gt;</span><br><span class="line">       select * from blog</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Blog&gt; selectBlogList();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       </span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       List&lt;Blog&gt; blogList = blogDao.selectBlogList();</span><br><span class="line">       </span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(blogList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>其他案例：post中的author 和 blog</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=&quot;Post&quot; id=&quot;postResultMap&quot;&gt;</span><br><span class="line">        &lt;id column=&quot;id&quot; property=&quot;id&quot; jdbcType=&quot;INTEGER&quot; /&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;association property=&quot;author&quot; column=&quot;author_id&quot; javaType=&quot;Author&quot;</span><br><span class="line">        select=&quot;name.yaohuan.mybatis.dao.AuthorMapper.selectAuthorById&quot;&gt;&lt;/association&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;association property=&quot;blog&quot; column=&quot;blog_id&quot; javaType=&quot;Blog&quot;</span><br><span class="line">        select=&quot;name.yaohuan.mybatis.dao.BlogMapper.selectBlogById&quot;&gt;&lt;/association&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>
<h3 id="19-高级结果映射-嵌套查询-集合映射"><a href="#19-高级结果映射-嵌套查询-集合映射" class="headerlink" title="19-高级结果映射-嵌套查询-集合映射"></a>19-高级结果映射-嵌套查询-集合映射</h3><p><strong>集合映射（适用于一对多和多对多）</strong></p>
<p><strong>需求：</strong>查询文章信息，同时查询这篇文章的评论列表</p>
<p><strong>思考：</strong>执行sql语句的条数</p>
<p>pojo：Post</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> name.yaohuan.mybatis.pojo;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Post</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Author author;</span><br><span class="line">    <span class="keyword">private</span> Blog blog;</span><br><span class="line">    <span class="keyword">private</span> Date createOn;</span><br><span class="line">    <span class="keyword">private</span> String section;</span><br><span class="line">    <span class="keyword">private</span> String subject;</span><br><span class="line">    <span class="keyword">private</span> String draft;</span><br><span class="line">    <span class="keyword">private</span> String body;</span><br><span class="line">    <span class="keyword">private</span> Integer visit;</span><br><span class="line">    <span class="comment">/*private List&lt;Tag&gt; tagList;*/</span><span class="comment">//作业</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Comment&gt; commentList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pojo：Comment </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.mybatis.pojo;</span><br><span class="line">import java.util.Date;</span><br><span class="line">public class Comment &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String comment;</span><br><span class="line">    private Date createOn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>post的mapper： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">"name.yaohuan.mybatis.dao.PostMapper"</span> &gt;</span><br><span class="line">    &lt;resultMap type=<span class="string">"Post"</span> id=<span class="string">"postResultMap"</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">"id"</span> property=<span class="string">"id"</span> jdbcType=<span class="string">"INTEGER"</span> /&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;association property=<span class="string">"author"</span> column=<span class="string">"author_id"</span> javaType=<span class="string">"Author"</span></span><br><span class="line">        select="name.yaohuan.mybatis.dao.AuthorMapper.selectAuthorById"&gt;&lt;/association&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;association property=<span class="string">"blog"</span> column=<span class="string">"blog_id"</span> javaType=<span class="string">"Blog"</span></span><br><span class="line">        select="name.yaohuan.mybatis.dao.BlogMapper.selectBlogById"&gt;&lt;/association&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;collection property=<span class="string">"commentList"</span> column=<span class="string">"id"</span> javaType=<span class="string">"ArrayList"</span> ofType=<span class="string">"Comment"</span></span><br><span class="line">        select="name.yaohuan.mybatis.dao.CommentMapper.selectCommentByPostId" &gt;&lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;!-- 思考执行了几条sql --&gt;    </span><br><span class="line">    &lt;select id=<span class="string">"selectPostById"</span> parameterType=<span class="string">"int"</span> resultMap=<span class="string">"postResultMap"</span>&gt;</span><br><span class="line">        SELECT * FROM post WHERE id = #&#123;id&#125; </span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;!-- 思考执行了几条sql --&gt;     </span><br><span class="line">    &lt;select id=<span class="string">"selectPostList"</span> parameterType=<span class="string">"int"</span> resultMap=<span class="string">"postResultMap"</span>&gt;</span><br><span class="line">        SELECT * FROM post</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<p>comment的mapper： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">"name.yaohuan.mybatis.dao.CommentMapper"</span> &gt;</span><br><span class="line">    &lt;resultMap type=<span class="string">"Comment"</span> id=<span class="string">"commentResultMap"</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">"id"</span> property=<span class="string">"id"</span> jdbcType=<span class="string">"INTEGER"</span> /&gt;</span><br><span class="line">        &lt;result column=<span class="string">"create_on"</span> property=<span class="string">"createOn"</span> jdbcType=<span class="string">"DATE"</span> /&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;select id=<span class="string">"selectCommentByPostId"</span> parameterType=<span class="string">"int"</span> resultMap=<span class="string">"commentResultMap"</span>&gt;</span><br><span class="line">        SELECT * FROM comment WHERE post_id = #&#123;postId&#125; </span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<p>post的接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.mybatis.dao;</span><br><span class="line">import java.util.List;</span><br><span class="line">import name.yaohuan.mybatis.pojo.Post;</span><br><span class="line">public interface PostMapper &#123;</span><br><span class="line">    Post selectPostById(Integer id);</span><br><span class="line">    List&lt;Post&gt; selectPostList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>comment的接口： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package name.yaohuan.mybatis.dao;</span><br><span class="line">import java.util.List;</span><br><span class="line">import name.yaohuan.mybatis.pojo.Comment;</span><br><span class="line">public interface CommentMapper &#123;</span><br><span class="line">    List&lt;Comment&gt; selectCommentByPostId(Integer postId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试用例： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectPostById</span><span class="params">()</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">     SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">     </span><br><span class="line">     PostMapper postDao = session.getMapper(PostMapper.class);</span><br><span class="line">     Post post = postDao.selectPostById(<span class="number">2</span>);</span><br><span class="line">     </span><br><span class="line">     session.close();</span><br><span class="line">     </span><br><span class="line">     System.out.println(post);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectPostList</span><span class="params">()</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">     SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">     </span><br><span class="line">     PostMapper postDao = session.getMapper(PostMapper.class);</span><br><span class="line">     List&lt;Post&gt; postList = postDao.selectPostList();</span><br><span class="line">     </span><br><span class="line">     session.close();</span><br><span class="line">     </span><br><span class="line">     System.out.println(postList);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="20-高级结果映射-嵌套结果"><a href="#20-高级结果映射-嵌套结果" class="headerlink" title="20-高级结果映射-嵌套结果"></a>20-高级结果映射-嵌套结果</h3><p>上一节讲了嵌套查询，嵌套查询的方式很简单，但是对于大型数据集合和列表将不会表现很好。问题就是我们熟知的“N+1查询问题”。</p>
<p>概括地讲，N+1查询问题可以是这样引起的：</p>
<ol>
<li>你执行了一个单独的SQL语句来获取结果列表（就是“+1”）。</li>
<li>对返回的每条记录，你执行了一个查询语句来为每个加载细节（就是“N”）。</li>
</ol>
<p>这个问题会导致成百上千的SQL语句被执行。这通常不是期望的。</p>
<p>所以还有另外一种方法：嵌套结果</p>
<p><strong>结果集映射：</strong></p>
<p><strong>方式一：</strong></p>
<p>使用 association 映射嵌套的结果列</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 嵌套结果 --&gt;</span><br><span class="line">    &lt;resultMap type=<span class="string">"Blog"</span> id=<span class="string">"blogResultMapNested"</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">"blog_id"</span> property=<span class="string">"id"</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">"blog_title"</span> property=<span class="string">"title"</span> /&gt;</span><br><span class="line">        &lt;result column=<span class="string">"blog_state"</span> property=<span class="string">"state"</span> /&gt;</span><br><span class="line">        &lt;result column=<span class="string">"blog_featured"</span> property=<span class="string">"featured"</span> /&gt;</span><br><span class="line">        &lt;association property=<span class="string">"author"</span> column=<span class="string">"blog_author_id"</span> javaType=<span class="string">"Author"</span>&gt;</span><br><span class="line">            &lt;id column=<span class="string">"author_id"</span> property=<span class="string">"id"</span> /&gt;</span><br><span class="line">            &lt;result column=<span class="string">"author_username"</span> property=<span class="string">"username"</span> /&gt;</span><br><span class="line">            &lt;result column=<span class="string">"author_password"</span> property=<span class="string">"password"</span> /&gt;</span><br><span class="line">            &lt;result column=<span class="string">"author_email"</span> property=<span class="string">"email"</span> /&gt;</span><br><span class="line">            &lt;result column=<span class="string">"author_bio"</span> property=<span class="string">"bio"</span> /&gt;</span><br><span class="line">            &lt;result column=<span class="string">"author_favourite_section"</span> property=<span class="string">"favouriteSection"</span> /&gt;</span><br><span class="line">        &lt;/association&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>
<p><strong>查询语句：</strong></p>
<p>注意：</p>
<p>1、要使用列的别名避免列名重复</p>
<p>2、使用关联查询（内连接、或外连接）将所有需要的列查询出来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   &lt;!-- 关联查询 --&gt;</span><br><span class="line">&lt;select id=<span class="string">"selectBlogListNested"</span> resultMap=<span class="string">"blogResultMapNested"</span>&gt;</span><br><span class="line">SELECT</span><br><span class="line"> b.id AS blog_id,</span><br><span class="line"> b.title AS blog_title,</span><br><span class="line"> b.author_id AS blog_author_id,</span><br><span class="line"> b.state AS blog_state,</span><br><span class="line"> b.featured AS blog_featured,</span><br><span class="line"> b.style AS blog_style,</span><br><span class="line"> a.id AS author_id,</span><br><span class="line"> a.username AS author_username,</span><br><span class="line"> a.password AS author_password,</span><br><span class="line"> a.email AS author_email,</span><br><span class="line"> a.bio AS author_bio,</span><br><span class="line"> a.favourite_section AS author_favourite_section,</span><br><span class="line"> a.nickname AS author_nickname,</span><br><span class="line"> a.realname AS author_realname</span><br><span class="line"> FROM blog b</span><br><span class="line"> LEFT JOIN author a</span><br><span class="line"> ON b.author_id = a.id</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>方式二：</p>
<p>使用继承，让结果集更灵活</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=&quot;Blog&quot; id=&quot;blogResultMap2&quot;&gt;</span><br><span class="line">      &lt;id column=&quot;blog_id&quot; property=&quot;id&quot;&gt;&lt;/id&gt;</span><br><span class="line">      &lt;result column=&quot;blog_title&quot; property=&quot;title&quot;/&gt;</span><br><span class="line">      &lt;result column=&quot;blog_state&quot; property=&quot;state&quot;/&gt;</span><br><span class="line">      &lt;result column=&quot;blog_featured&quot; property=&quot;featured&quot;/&gt;</span><br><span class="line">      &lt;result column=&quot;blog_style&quot; property=&quot;style&quot;/&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br><span class="line">  &lt;resultMap type=&quot;Blog&quot; id=&quot;blogResultMapNested2&quot; extends=&quot;blogResultMap2&quot;&gt;</span><br><span class="line">      &lt;association column=&quot;blog_author_id&quot; property=&quot;author&quot; javaType=&quot;Author&quot;&gt;</span><br><span class="line">          &lt;id column=&quot;author_id&quot; property=&quot;id&quot;&gt;&lt;/id&gt;</span><br><span class="line">          &lt;result column=&quot;author_username&quot; property=&quot;username&quot;/&gt;</span><br><span class="line">          &lt;result column=&quot;author_password&quot; property=&quot;password&quot;/&gt;</span><br><span class="line">          &lt;result column=&quot;author_email&quot; property=&quot;email&quot;/&gt;</span><br><span class="line">          &lt;result column=&quot;author_bio&quot; property=&quot;bio&quot;/&gt;</span><br><span class="line">          &lt;result column=&quot;author_favourite_section&quot; property=&quot;favouriteSection&quot;/&gt;</span><br><span class="line">          &lt;result column=&quot;author_nickname&quot; property=&quot;nickname&quot;/&gt;</span><br><span class="line">          &lt;result column=&quot;author_realname&quot; property=&quot;realname&quot;/&gt;</span><br><span class="line">      &lt;/association&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;select id=&quot;selectBlogListNested&quot; resultMap=&quot;blogResultMapNested2&quot;&gt;</span><br><span class="line">  SELECT </span><br><span class="line">    b.id AS blog_id,</span><br><span class="line">    b.title AS blog_title,</span><br><span class="line">    b.author_id AS blog_author_id,</span><br><span class="line">    b.state AS blog_state,</span><br><span class="line">    b.featured AS blog_featured,</span><br><span class="line">    b.style AS blog_style,</span><br><span class="line">    </span><br><span class="line">    a.id AS author_id,</span><br><span class="line">    a.username AS author_username,</span><br><span class="line">    a.password AS author_password,</span><br><span class="line">    a.email AS author_email,</span><br><span class="line">    a.bio AS author_bio,</span><br><span class="line">    a.favourite_section AS author_favourite_section,</span><br><span class="line">    a.nickname AS author_nickname,</span><br><span class="line">    a.realname AS author_realname</span><br><span class="line">  </span><br><span class="line">  FROM blog b</span><br><span class="line">  LEFT JOIN author a</span><br><span class="line">  ON b.author_id = a.id</span><br><span class="line">  &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h3 id="21-高级结果映射-构造方法映射"><a href="#21-高级结果映射-构造方法映射" class="headerlink" title="21-高级结果映射-构造方法映射"></a>21-高级结果映射-构造方法映射</h3><p><strong>pojo中创建构造方法：</strong></p>
<p>1、注意：要使用Integer而不是int</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public Blog(Integer id, String title) &#123;</span><br><span class="line">       super();</span><br><span class="line">       this.id = id;</span><br><span class="line">       this.title = title;</span><br><span class="line">       System.out.println(&quot;构造方法。。。。。。。。。。。。。。&quot;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>mapper中创建构造方法映射：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 构造方法映射 --&gt;</span><br><span class="line">  &lt;resultMap type=&quot;Blog&quot; id=&quot;blogResultMapConstructor&quot;&gt;</span><br><span class="line">      &lt;constructor&gt;</span><br><span class="line">          &lt;idArg column=&quot;id&quot; javaType=&quot;int&quot; /&gt;</span><br><span class="line">          &lt;arg column=&quot;title&quot; javaType=&quot;string&quot; /&gt;</span><br><span class="line">      &lt;/constructor&gt;</span><br><span class="line">  &lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>
<p><strong>使用构造方法的映射结果：</strong></p>
<p>注意：</p>
<p>1、include中的内容包含：id, title, author_id, state, featured</p>
<p>mybatis在做结果映射的时候会首先调用构造函数将id，和title映射到结果对象中，</p>
<p>然后调用 setXxx 方法 将state 和 featured 映射到结果对象中</p>
<p>如果需要映射 author 属性，则可以按照之前的方法 添加 <association> 节点做嵌套查询映射</association></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogConstructor&quot; parameterType=&quot;int&quot; </span><br><span class="line">   resultMap=&quot;blogResultMapConstructor&quot;&gt;</span><br><span class="line">         select &lt;include refid=&quot;columnWords&quot;&gt;&lt;/include&gt; from Blog where id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>接口：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog selectBlogConstructor(Integer id);</span><br></pre></td></tr></table></figure>
<p><strong>测试：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void testSelectBlogConstructor()&#123;</span><br><span class="line">       </span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       Blog blog = blogDao.selectBlogConstructor(3);</span><br><span class="line">       session.close();</span><br><span class="line">       System.out.println(blog);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-高级结果映射-鉴别器"><a href="#22-高级结果映射-鉴别器" class="headerlink" title="22-高级结果映射-鉴别器"></a>22-高级结果映射-鉴别器</h3><p>类型鉴别器，帮助实现创建多态的对象，用于多态映射</p>
<p><strong>示例：</strong></p>
<p>一、类设计</p>
<p>1、交通工具类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Vehicle &#123;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String vin;//车辆识别代码Veterinary information network</span><br><span class="line">    private Date year;</span><br><span class="line">    private String make;//品牌：what make is it</span><br><span class="line">    private String model;//</span><br><span class="line">    private String color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、小汽车类 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public class Car extends Vehicle&#123;</span><br><span class="line">    private Integer doorCount;</span><br></pre></td></tr></table></figure>
<p>3、Suv类  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class Suv extends Vehicle&#123;</span><br><span class="line">    private Boolean allWheelDrive;//全轮驱动 awd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二、数据库设计</p>
<p><img src="https://vipkshttps13.wiz.cn/ks/note/view/bb461bed-93db-4f2e-a3f0-69f99ac1fcde/560bff0d-ebe1-4be0-82ef-86bdeb5eb3f1/index_files/ec717d45-dd82-4e34-a743-5bfd49847321.png" alt="img"> </p>
<p><img src="C:\Users\Administrator\AppData\Local\Temp\1543935456269.png" alt="1543935456269"></p>
<p> 三、代码实现</p>
<p><strong>配置文件：</strong></p>
<p>注意：</p>
<p>1、一定要有鉴别器，测试才能通过</p>
<p>2、查询结果中一定要包含鉴别器列</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=<span class="string">"Vehicle"</span> id=<span class="string">"vehicleResultMap"</span>&gt;</span><br><span class="line">       &lt;id column=<span class="string">"id"</span> property=<span class="string">"id"</span>/&gt;</span><br><span class="line">       &lt;discriminator javaType=<span class="string">"int"</span> column=<span class="string">"vehicle_type"</span>&gt;</span><br><span class="line">           &lt;<span class="keyword">case</span> value=<span class="string">"1"</span> resultType=<span class="string">"Car"</span>&gt;</span><br><span class="line">               &lt;result property=<span class="string">"doorCount"</span> column=<span class="string">"door_count"</span> /&gt;</span><br><span class="line">           &lt;/case&gt;</span><br><span class="line">           &lt;<span class="keyword">case</span> value=<span class="string">"2"</span> resultType=<span class="string">"Suv"</span>&gt;</span><br><span class="line">               &lt;result property=<span class="string">"allWheelDrive"</span> column=<span class="string">"all_wheel_drive"</span> /&gt;</span><br><span class="line">           &lt;/case&gt;</span><br><span class="line">       &lt;/discriminator&gt;</span><br><span class="line">   &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">   &lt;select id=<span class="string">"selectVehicleById"</span> parameterType=<span class="string">"int"</span> </span><br><span class="line">   resultMap=<span class="string">"vehicleResultMap"</span>&gt;</span><br><span class="line">       SELECT * FROM Vehicle WHERE id = #&#123;id&#125;</span><br><span class="line">   &lt;/select&gt;</span><br><span class="line">   &lt;select id=<span class="string">"selectVehicleList"</span> resultMap=<span class="string">"vehicleResultMap"</span>&gt;</span><br><span class="line">       SELECT * FROM Vehicle</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>接口：</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface VehicleMapper &#123;</span><br><span class="line">    public Vehicle selectVehicleById(Integer id);</span><br><span class="line">    public List&lt;Vehicle&gt; selectVehicleList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试：</strong></p>
<p>方法1：打印对象地址可以看出对象是多态的</p>
<p>方法2：用断点调试可以发现取出的对象是多态的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectVehicleById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      </span><br><span class="line">      SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">      </span><br><span class="line">      VehicleMapper vehicleDao = session.getMapper(VehicleMapper.class);</span><br><span class="line">      <span class="comment">/*Car vehicle1 = (Car)vehicleDao.selectVehicleById(1);</span></span><br><span class="line"><span class="comment">      Suv vehicle3 = (Suv)vehicleDao.selectVehicleById(3);*/</span></span><br><span class="line">      Vehicle vehicle1 = vehicleDao.selectVehicleById(<span class="number">1</span>);</span><br><span class="line">      Vehicle vehicle3 = vehicleDao.selectVehicleById(<span class="number">3</span>);</span><br><span class="line">      </span><br><span class="line">      session.close();</span><br><span class="line">      System.out.println(vehicle1);</span><br><span class="line">      System.out.println(vehicle3);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-性能-延迟加载"><a href="#23-性能-延迟加载" class="headerlink" title="23-性能-延迟加载"></a>23-性能-延迟加载</h3><p>延迟加载又叫懒加载，也叫按需加载。也就是说先加载主信息，在需要的时候，再去加载从信息。</p>
<p>在mybatis中，resultMap标签 的association标签和collection标签具有延迟加载的功能。</p>
<p><strong>1、拷贝jar包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cglib&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cglib&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.6&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>2、配置全局设置</strong></p>
<p>目前的mybatis版本对 aggressiveLazyLoading 的支持不好？？？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 全局设置 --&gt;</span><br><span class="line">   &lt;settings&gt;</span><br><span class="line">       &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">       &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">   &lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<p><strong>官方对这两个属性的解释是：</strong></p>
<p><strong>lazyLoadingEnabled</strong> 全局启用或禁用延迟加载。当禁用时，所有关联对象都会即时加载。（是否延迟加载当前对象的关联对象）</p>
<p><strong>aggressiveLazyLoading</strong> 当启用时，有延迟加载属性的对象在被调用时将会完全加载任意属性。否则，每种属性将会按需要加载。（是否延迟加载当前对象属性的关联对象）</p>
<p>延迟加载会生成代理对象</p>
<p> <strong>3、测试</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 测试延迟加载</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectBlogLazyLoading</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">       BlogMapper blogDao = session.getMapper(BlogMapper.class);</span><br><span class="line">       System.out.println(<span class="string">"查询blog"</span>);</span><br><span class="line">       Blog blog = blogDao.selectBlogById(<span class="number">3</span>);<span class="comment">//执行查询blog的sql语句</span></span><br><span class="line">       <span class="comment">//System.out.println(blog);</span></span><br><span class="line">       session.close();</span><br><span class="line">       </span><br><span class="line">       System.out.println(<span class="string">"查询title属性"</span>);</span><br><span class="line">       System.out.println(blog.getTitle());<span class="comment">//不执行任何sql语句</span></span><br><span class="line">       System.out.println(<span class="string">"查询author属性"</span>);</span><br><span class="line">       System.out.println(blog.getAuthor().getUsername());<span class="comment">//执行查询作者的sql语句</span></span><br><span class="line">       System.out.println(<span class="string">"结束"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>（1）什么都不配置</strong></p>
<p>查询blog</p>
<p>Opening JDBC Connection</p>
<p>Created connection 798244209.</p>
<p>Setting autocommit to false on JDBC Connection</p>
<p>==&gt;  Preparing: SELECT * FROM blog WHERE id = ? </p>
<p>====&gt;  Preparing: SELECT * FROM author WHERE id = ? </p>
<p>Resetting autocommit to true on JDBC Connection</p>
<p>Closing JDBC Connection</p>
<p>Returned connection 798244209 to pool.</p>
<p>查询title属性</p>
<p>姚延军的空间</p>
<p>查询author属性</p>
<p>yaoyanjun</p>
<p>结束</p>
<p><strong>（2）配置</strong> <setting name="lazyLoadingEnabled" value="true"></setting></p>
<p>只要结果映射中配置了association</p>
<p>则执行懒加载特性：不查询blog的属性，则不执行子查询，一旦查询任意属性则执行子查询(无论查不查author，都会执行author的查询sql)</p>
<p>查询blog</p>
<p>Opening JDBC Connection</p>
<p>Created connection 798244209.</p>
<p>Setting autocommit to false on JDBC Connection</p>
<p>==&gt;  Preparing: SELECT * FROM blog WHERE id = ? </p>
<p>Resetting autocommit to true on JDBC Connection</p>
<p>Closing JDBC Connection</p>
<p>Returned connection 798244209 to pool.</p>
<p>查询title属性</p>
<p>Opening JDBC Connection</p>
<p>Checked out connection 798244209 from pool.</p>
<p>Setting autocommit to false on JDBC Connection</p>
<p>==&gt;  Preparing: SELECT * FROM author WHERE id = ? </p>
<p>Resetting autocommit to true on JDBC Connection</p>
<p>Closing JDBC Connection</p>
<p>Returned connection 798244209 to pool.</p>
<p>姚延军的空间</p>
<p>查询author属性</p>
<p>yaoyanjun</p>
<p>结束</p>
<p><strong>（3）配置</strong> <setting name="aggressiveLazyLoading" value="false"></setting></p>
<p>author属性将会按需加载：例如如果不查询author，则不会执行author的查询sql</p>
<p>查询blog</p>
<p>Opening JDBC Connection</p>
<p>Created connection 798244209.</p>
<p>Setting autocommit to false on JDBC Connection</p>
<p>==&gt;  Preparing: SELECT * FROM blog WHERE id = ? </p>
<p>Resetting autocommit to true on JDBC Connection</p>
<p>Closing JDBC Connection</p>
<p>Returned connection 798244209 to pool.</p>
<p>查询title属性</p>
<p>姚延军的空间</p>
<p>结束</p>
<h3 id="24-逆向工程maven版"><a href="#24-逆向工程maven版" class="headerlink" title="24-逆向工程maven版"></a>24-逆向工程maven版</h3><p><a href="http://blog.csdn.net/modote9527/article/details/69053751" target="_blank" rel="noopener">http://blog.csdn.net/modote9527/article/details/69053751</a></p>
<p>1、创建maven项目 <strong>mybatis03generator</strong></p>
<p>2、创建数据库 oa</p>
<p>执行脚本：权限管理基础表.sql</p>
<p>3、添加依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--  mybatis逆向工程jar包 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>4、添加插件 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">            &lt;dependencies&gt;</span><br><span class="line">                &lt;dependency&gt;</span><br><span class="line">                    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">                    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">                    &lt;version&gt;5.1.45&lt;/version&gt;</span><br><span class="line">                &lt;/dependency&gt;</span><br><span class="line">            &lt;/dependencies&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;!--配置文件的路径--&gt;</span><br><span class="line">                &lt;configurationFile&gt;$&#123;basedir&#125;/src/main/resources/generatorConfig.xml&lt;/configurationFile&gt;</span><br><span class="line">                &lt;overwrite&gt;true&lt;/overwrite&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<p>5、resources下创建 generatorConfig.xml</p>
<p>配置参考：<a href="https://blog.csdn.net/isea533/article/details/42102297" target="_blank" rel="noopener">https://blog.csdn.net/isea533/article/details/42102297</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE generatorConfiguration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;generatorConfiguration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context id=&quot;mysql&quot; targetRuntime=&quot;MyBatis3&quot;  defaultModelType=&quot;flat&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--分隔符--&gt;</span><br><span class="line">        &lt;property name=&quot;autoDelimitKeywords&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;beginningDelimiter&quot; value=&quot;`&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;endingDelimiter&quot; value=&quot;`&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 一些工具 --&gt;</span><br><span class="line">        &lt;plugin type=&quot;org.mybatis.generator.plugins.EqualsHashCodePlugin&quot;&gt;&lt;/plugin&gt;</span><br><span class="line">        &lt;plugin type=&quot;org.mybatis.generator.plugins.SerializablePlugin&quot;&gt;&lt;/plugin&gt;</span><br><span class="line">        &lt;plugin type=&quot;org.mybatis.generator.plugins.ToStringPlugin&quot;&gt;&lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">        &lt;commentGenerator&gt;</span><br><span class="line">            &lt;!--取消时间戳--&gt;</span><br><span class="line">            &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">            &lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span><br><span class="line">            &lt;property name=&quot;suppressAllComments&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">        &lt;/commentGenerator&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!--数据库链接参数--&gt;</span><br><span class="line">        &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">                        connectionURL=&quot;jdbc:mysql://localhost:3306/oa_bj1802&quot; userId=&quot;root&quot;</span><br><span class="line">                        password=&quot;123456&quot;&gt;&lt;/jdbcConnection&gt;</span><br><span class="line"></span><br><span class="line">        &lt;javaTypeResolver&gt;</span><br><span class="line">            &lt;!-- This property is used to specify whether MyBatis Generator should</span><br><span class="line">               force the use of java.math.BigDecimal for DECIMAL and NUMERIC fields, --&gt;</span><br><span class="line">            &lt;!-- 默认false，把JDBC DECIMAL 和 NUMERIC 类型解析为 Integer/Long，为 true时把JDBC DECIMAL 和</span><br><span class="line">         NUMERIC 类型解析为java.math.BigDecimal --&gt;</span><br><span class="line">            &lt;property name=&quot;forceBigDecimals&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/javaTypeResolver&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!--pojo模型的位置和包名--&gt;</span><br><span class="line">        &lt;javaModelGenerator targetPackage=&quot;com.qfedu.oa.pojo&quot; targetProject=&quot;src/main/java&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/javaModelGenerator&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--mapper映射文件的位置和包名--&gt;</span><br><span class="line">        &lt;sqlMapGenerator targetPackage=&quot;com.qfedu.oa.dao&quot; targetProject=&quot;src/main/java&quot;&gt;&lt;/sqlMapGenerator&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 生成DAO的包名和位置 XMLMAPPER | ANNOTATEDMAPPER--&gt;</span><br><span class="line">        &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.qfedu.oa.dao&quot; targetProject=&quot;src/main/java&quot;&gt;&lt;/javaClientGenerator&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!-- 要生成哪些表 --&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_menu&quot; domainObjectName=&quot;SysMenu&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_role&quot; domainObjectName=&quot;SysRole&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_user&quot; domainObjectName=&quot;SysUser&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_role_menu&quot; domainObjectName=&quot;SysRoleMenu&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_user_role&quot; domainObjectName=&quot;SysUserRole&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_config&quot; domainObjectName=&quot;SysConfig&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;table tableName=&quot;sys_log&quot; domainObjectName=&quot;SysLog&quot;&gt;</span><br><span class="line">            &lt;generatedKey column=&quot;id&quot; sqlStatement=&quot;Mysql&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/context&gt;</span><br><span class="line"></span><br><span class="line">&lt;/generatorConfiguration&gt;</span><br></pre></td></tr></table></figure>
<p><strong>6、运行</strong></p>
<p>mybatis-generator:generate</p>
</cache>
    </div>
  </article>
  <div class="post-nav">
    <div class="post-nav-next post-nav-item">
      
        <a href="/2018/12/04/SpringMVC/" rel="next" title="SpringMVC详解">
          <i class="fa fa-chevron-left"></i> SpringMVC详解
        </a>
      
    </div>

    <span class="post-nav-divider"></span>

    <div class="post-nav-prev post-nav-item">
    
    </div>
  </div>



      </div>
        <div class="footer">
  <div class="footer-wrapper">
    <div class="copyright">
      
      <span>&copy;</span>
      
      <span>2017 - 2018</span>
      
      <span class="author"><i class="fa fa-user"></i>木木夕</span>
    </div>
    
      <span>由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</span>
    
    
      <span>|</span> <span>主题 - <a href="https://github.com/littleee/corazon">Corazon</a></span>
      
        <span>v1.0.0</span>
      
    
  </div>
</div>

    </main>
  </body>
</html>
